<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ | æ‚¨çš„å°ˆå±¬CFPé¡§å• æ—é¦¬ä¸è£½ä½œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #f8f9fa;
            --bg-color: #f4f7f6;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 15px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10; /* ç¢ºä¿è“‹åœ¨ PDF å±¤ä¸Šé¢ */
        }
        
        /* === è¼¸å…¥ä»‹é¢ === */
        h1 { color: var(--primary-color); text-align: center; font-size: 1.5em; }
        .quadrant-box {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .quadrant-title {
            font-weight: bold;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .question-row { display: flex; flex-direction: column; margin-bottom: 10px; } /* æ‰‹æ©Ÿå„ªå…ˆï¼šå‚ç›´æ’åˆ— */
        .question-label { font-size: 0.95em; margin-bottom: 5px; }
        .input-wrapper { display: flex; align-items: center; }
        input[type="range"] { flex: 1; margin: 0 10px; cursor: pointer; height: 30px; }
        
        @media(min-width: 600px) {
            .question-row { flex-direction: row; align-items: center; justify-content: space-between; }
            .question-label { margin-bottom: 0; flex: 1; }
        }

        .btn {
            display: block; width: 100%; padding: 15px;
            background-color: var(--primary-color); color: white;
            border: none; border-radius: 5px; font-size: 1.2em;
            cursor: pointer; margin-top: 20px;
        }
        .btn:hover { background-color: #004494; }

        /* === è¢å¹•çµæœé¡¯ç¤ºå€ (Web View) === */
        #webReportArea { display: none; }
        .web-score-card {
            background: var(--accent-color); padding: 20px; border-radius: 8px;
            text-align: center; margin-bottom: 20px;
        }
        
        /* æ–°å¢ï¼šWeb ç‰ˆé›·é”åœ–å®¹å™¨ */
        .chart-container-web {
            position: relative;
            height: 300px; /* æ‰‹æ©Ÿä¸Šå›ºå®šé«˜åº¦ */
            width: 100%;
            max-width: 500px; /* é¿å…åœ¨é›»è…¦ä¸Šå¤ªå¤§ */
            margin: 0 auto 20px auto;
        }

        .web-advice-item {
            border-left: 5px solid var(--primary-color);
            background: #fff; padding: 15px; margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* === PDF å°ˆç”¨éš±è—å€ (Hidden A4 Layer) === */
        /* é—œéµï¼šå¼·åˆ¶å¯¬åº¦ 794px (A4)ï¼Œä¸¦è—åœ¨æœ€åº•å±¤ */
        #pdfHiddenLayer {
            position: absolute;
            top: 0; left: 0;
            width: 794px; /* A4 æ¨™æº–å¯¬åº¦ */
            z-index: -999; /* è—åœ¨åº•ä¸‹ */
            visibility: hidden; /* ç”¨æˆ¶çœ‹ä¸è¦‹ï¼Œä½† html2canvas çœ‹å¾—è¦‹ */
            background: white;
        }

        /* PDF å…§é æ’ç‰ˆ */
        .pdf-page {
            width: 794px;
            height: 1123px; /* A4 æ¨™æº–é«˜åº¦ */
            padding: 40px;
            box-sizing: border-box;
            background: white;
            position: relative;
        }
        
        /* æ–°å¢ï¼šPDF ç‰ˆé›·é”åœ–å®¹å™¨ (å›ºå®šå°ºå¯¸) */
        .chart-container-pdf {
            position: relative;
            width: 450px;
            height: 400px;
            margin: 0 auto 10px auto;
        }
        
        .pdf-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
        .pdf-table th, .pdf-table td { border: 1px solid #333; padding: 10px; text-align: center; }
        .pdf-table th { background-color: var(--primary-color); color: white; }

        /* è¼‰å…¥é®ç½© */
        #loading {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); color: white; z-index: 9999;
            text-align: center; padding-top: 40vh;
        }
    </style>
</head>
<body>

<div id="loading">æ­£åœ¨è£½ä½œ PDF å ±å‘Šæ›¸...<br><span style="font-size:0.8em">æ‰‹æ©Ÿéœ€æ™‚ç´„ 3-5 ç§’</span></div>

<div class="container">
    
    <div id="inputForm">
        <h1>é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç«™</h1>
        <p style="text-align: center; color: #666;">è«‹æ»‘å‹•è©•åˆ† (0åˆ†:ä¸è¶³ ~ 5åˆ†:å……è¶³)</p>
        <div id="quizContainer"></div>
        <button type="button" class="btn" onclick="showResults()">æŸ¥çœ‹è¨ºæ–·çµæœ</button>
    </div>

    <div id="webReportArea">
        <h2>è¨ºæ–·çµæœç¸½è¦½</h2>
        <div class="web-score-card">
            <div>ç¶œåˆè©•ä¼°å¾—åˆ†</div>
            <div style="font-size: 3em; font-weight: bold; color: #d9534f;">
                <span id="webTotal">0</span> / 100
            </div>
        </div>
        
        <div class="chart-container-web">
            <canvas id="webRadarChart"></canvas>
        </div>

        <div id="webAdviceList"></div>

        <div style="text-align: center; margin-top: 30px;">
            <p style="color: #0056b3;">æƒ³ä¿å­˜è©³ç´°çš„ A4 å ±å‘Šå—ï¼Ÿ</p>
            <button class="btn" style="background-color: #28a745;" onclick="downloadPDF()">ğŸ“¥ ä¸‹è¼‰å®Œæ•´ PDF å ±å‘Š</button>
            <button class="btn" style="background-color: #6c757d; margin-top: 10px;" onclick="location.reload()">ğŸ”„ é‡æ–°æ¸¬é©—</button>
        </div>
    </div>
</div>

<div id="pdfHiddenLayer">
    
    <div class="pdf-page" id="pdfPage1">
        <h2 style="text-align: center; color: #0056b3;">å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦è¨ºæ–·æ›¸</h2>
        <p style="text-align: center; color: #666;">è¨ºæ–·æ—¥æœŸï¼š<span id="pdfDate"></span></p>

        <div style="text-align: center; background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 30px 50px;">
            <div style="font-size: 1.2em; color: #555;">ç¶œåˆè©•ä¼°å¾—åˆ†</div>
            <div style="font-size: 4em; font-weight: bold; color: #d9534f;">
                <span id="pdfTotal">0</span> <span style="font-size: 0.4em; color:#888;">/ 100</span>
            </div>
        </div>

        <div class="chart-container-pdf">
            <canvas id="pdfRadarChart"></canvas>
        </div>

        <table class="pdf-table">
            <thead>
                <tr>
                    <th width="40%">æª¢æ¸¬é¢å‘</th>
                    <th width="30%">å¾—åˆ†</th>
                    <th width="30%">ç‹€æ…‹</th>
                </tr>
            </thead>
            <tbody id="pdfTableBody"></tbody>
        </table>
        
        <div style="position: absolute; bottom: 40px; width: 100%; text-align: center; color: #999;">- ç¬¬ 1 é  / å…± 2 é  -</div>
    </div>

    <div class="pdf-page" id="pdfPage2">
        <h3 style="color: #0056b3; border-bottom: 2px solid #ccc; padding-bottom: 10px;">ã€å°ˆå±¬è¡Œå‹•æ–¹é‡ã€‘</h3>
        <div id="pdfAdviceList"></div>

        <div style="position: absolute; bottom: 40px; width: 100%; text-align: center; color: #999;">
            æœ¬å ±å‘Šç”± AI è¼”åŠ©ç³»çµ±ç”Ÿæˆï¼Œå»ºè­°é ç´„ CFP é¡§å• æ—é¦¬ä¸ é€²è¡Œæ·±å…¥è§£è®€<br>- ç¬¬ 2 é  / å…± 2 é  -
        </div>
    </div>
</div>

<script>
    const questions = {
        finance: { label: "è²¡å‹™åŸºç«™", items: ["è¢«å‹•æ”¶å…¥è¦†è“‹ç‡", "ç·Šæ€¥é å‚™é‡‘å……è¶³åº¦", "é†«ç™‚é˜²ç¦¦ä¿‚æ•¸", "è² å‚µæ­¸é›¶è¨ˆç•«", "è³‡ç”¢é…ç½®å¤šå…ƒæ€§"] },
        health: { label: "èº«å¿ƒçºŒèˆª", items: ["èº«é«”è³ªé‡æŒ‡æ•¸ (BMI)", "è‚Œè‚‰é‡èˆ‡è¡Œå‹•åŠ›", "è¦å¾‹é‹å‹•ç¿’æ…£", "ç¡çœ å“è³ª", "å®¶æ—ç—…å²è¿½è¹¤"] },
        social: { label: "ç¤¾äº¤æ¼«éŠ", items: ["éè·å ´æœ‹å‹æ•¸é‡", "è·¨ä»£é€£çµé »ç‡", "ç¤¾ç¾¤åƒèˆ‡åº¦", "è¦ªå¯†é—œä¿‚å¸³æˆ¶", "ç·Šæ€¥æ•‘æ´ç¶²"] },
        purpose: { label: "ç¬¬äºŒäººç”Ÿ", items: ["èº«ä»½èªåŒåˆ‡æ›", "æ™‚é–“çµæ§‹åŒ–èƒ½åŠ›", "å¿ƒæµé«”é©—é »ç‡", "å­¸ç¿’æ–°æŠ€èƒ½æ„é¡˜", "åœ“å¤¢åŸ·è¡ŒåŠ›"] }
    };

    // æ–°å¢ï¼šåœ–è¡¨å¯¦ä¾‹è®Šæ•¸ (ç”¨æ–¼éŠ·æ¯€é‡ç¹ª)
    let webChart = null;
    let pdfChart = null;

    function init() {
        const container = document.getElementById('quizContainer');
        for (let key in questions) {
            let section = document.createElement('div');
            section.className = 'quadrant-box';
            let html = `<div class="quadrant-title">${questions[key].label}</div>`;
            questions[key].items.forEach(item => {
                html += `
                    <div class="question-row">
                        <div class="question-label">${item}</div>
                        <div class="input-wrapper">
                            <input type="range" min="0" max="5" value="0" data-cat="${key}" oninput="this.parentElement.nextElementSibling.innerText = this.value">
                            <span style="width:20px; text-align:center; font-weight:bold; margin-left:10px;">0</span>
                        </div>
                    </div>`;
            });
            section.innerHTML = html;
            container.appendChild(section);
        }
        document.getElementById('pdfDate').innerText = new Date().toLocaleDateString();
    }

    function getAdvice(score, type) {
        let level = score >= 20 ? 'high' : (score >= 11 ? 'mid' : 'low');
        const logic = {
            finance: {
                low: "ç”Ÿå­˜ç„¦æ…®æœŸï¼šè¢«å‹•æ”¶å…¥åš´é‡ä¸è¶³ã€‚å»ºè­°å„ªå…ˆåŸ·è¡Œå‚µå‹™é›ªçƒæ³•ï¼Œä¸¦å¼·åˆ¶å­˜æ»¿3å€‹æœˆç·Šæ€¥é å‚™é‡‘ã€‚",
                mid: "è³‡ç”¢ç´¯ç©æœŸï¼šè³‡ç”¢æŠ—é€šè†¨åŠ›è„†å¼±ã€‚å»ºè­°å°‡è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ç›®æ¨™è¨­ç‚º70%ï¼Œä¸¦è£œè¶³é†«ç™‚ç¼ºå£ã€‚",
                high: "è²¡å¯Œå‚³æ‰¿æœŸï¼šè²¡å‹™è‡ªç”±ã€‚å»ºè­°è«®è©¢ä¿¡è¨—æ¶æ§‹æˆ–ç¨…å‹™è¦åŠƒï¼Œç¢ºä¿è³‡ç”¢èƒ½ä¾æ‚¨çš„æ„é¡˜å‚³æ‰¿ã€‚"
            },
            health: {
                low: "å¥åº·å´©å£æœŸï¼šé€€ä¼‘æœ€å¤§éš±æ†‚ã€‚è«‹ç«‹å³é ç´„å¥æª¢ï¼Œä¸¦å¾ã€Œæ¯å¤©æ­¥è¡Œ15åˆ†é˜ã€èˆ‡æ¸›ç³–é£²é£Ÿé–‹å§‹ã€‚",
                mid: "äºå¥åº·èª¿æ•´æœŸï¼šè‚ŒåŠ›æœ‰æµå¤±é¢¨éšªã€‚å»ºè­°æ¯é€±è‡³å°‘2æ¬¡é˜»åŠ›è¨“ç·´ï¼Œä¸¦é…æˆ´è£ç½®ç›£æ§ç¡çœ ã€‚",
                high: "æ¨‚æ´»é•·å£½æœŸï¼šé«”æ³æ¥µä½³ã€‚å»ºè­°æŒçºŒæŒ‘æˆ°éœ€ã€Œè…¦é«”å”èª¿ã€çš„æ–°é‹å‹•ï¼ˆå¦‚ç¶²çƒã€èˆè¹ˆï¼‰ã€‚"
            },
            social: {
                low: "å­¤å³¶æ•ˆæ‡‰æœŸï¼šç”Ÿæ´»åœˆå°é–‰ã€‚å»ºè­°æ¯æœˆä¸»å‹•è¯ç¹«ä¸€ä½è€å‹ï¼Œä¸¦å¼·åˆ¶è‡ªå·±åƒåŠ ä¸€å€‹å¯¦é«”èˆˆè¶£ç¤¾åœ˜ã€‚",
                mid: "ç¤¾äº¤é‡çµ„æœŸï¼šé€£çµæ·±åº¦ä¸è¶³ã€‚å»ºè­°æŒ‘é¸3ä½æœ‹å‹å»ºç«‹æ·±åº¦èšæœƒï¼Œä¸¦å»ºç«‹ç·Šæ€¥äº’åŠ©è¯çµ¡ç¶²ã€‚",
                high: "ç¤¾ç¾¤æ¨ç´æœŸï¼šäººè„ˆå»£é—Šã€‚å»ºè­°é€²è¡Œç¤¾äº¤æ–·æ¨é›¢ï¼Œå°‡æ™‚é–“ç•™çµ¦çœŸæ­£æ»‹é¤Šå¿ƒéˆçš„æ·±åº¦é—œä¿‚ã€‚"
            },
            purpose: {
                low: "å¤±å»é‡åŠ›æœŸï¼šè‡ªæˆ‘åƒ¹å€¼è¿·æƒ˜ã€‚è«‹ç·´ç¿’ã€Œä¸æè·ç¨±ã€ä»‹ç´¹è‡ªå·±ï¼Œåˆ—å‡º10å€‹èˆˆè¶£é€²è¡Œä½æˆæœ¬è©¦éŒ¯ã€‚",
                mid: "æ¢ç´¢å®šéŒ¨æœŸï¼šç¼ºä¹åŸ·è¡ŒåŠ›ã€‚è«‹è¨­å®šå…·é«”çš„å­¸ç¿’ç›®æ¨™ï¼ˆå¦‚è€ƒè­‰ç…§ï¼‰ï¼Œå°‡èˆˆè¶£è½‰åŒ–ç‚ºç”¢å‡ºã€‚",
                high: "è‡ªæˆ‘å¯¦ç¾æœŸï¼šç›®æ¨™æ¸…æ™°ã€‚è«‹å³åˆ»å•Ÿå‹•åœ“å¤¢å¤§è¨ˆç•«ï¼Œæˆ–é€éå¯«ä½œã€æ¼”è¬›åˆ†äº«äººç”Ÿæ™ºæ…§ã€‚"
            }
        };
        return logic[type][level];
    }

    // æ–°å¢ï¼šç¹ªè£½é›·é”åœ–å‡½æ•¸
    function drawChart(canvasId, data, isPdf) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        return new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['è²¡å‹™', 'å¥åº·', 'ç¤¾äº¤', 'äººç”Ÿ'],
                datasets: [{
                    label: 'æº–å‚™åº¦',
                    data: data,
                    backgroundColor: 'rgba(0, 86, 179, 0.2)',
                    borderColor: '#0056b3',
                    borderWidth: 2,
                    pointBackgroundColor: '#0056b3',
                    pointRadius: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                // é—œéµï¼šPDF ç‰ˆå¿…é ˆé—œé–‰å‹•ç•«ï¼Œå¦å‰‡æˆªåœ–æ™‚æœƒæ˜¯ç©ºç™½
                animation: isPdf ? false : { duration: 1000 },
                scales: {
                    r: {
                        suggestedMin: 0,
                        suggestedMax: 25,
                        // PDF ç‰ˆéš±è—åˆ»åº¦æ•¸å­—ï¼Œè®“ç•«é¢æ›´ä¹¾æ·¨
                        ticks: { stepSize: 5, display: !isPdf } 
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function showResults() {
        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => {
            scores[input.dataset.cat] += parseInt(input.value);
        });

        let total = Object.values(scores).reduce((a,b)=>a+b, 0);

        // 1. å¡«å…¥ã€Œè¢å¹•ç‰ˆã€è³‡æ–™
        document.getElementById('webTotal').innerText = total;
        let webAdviceHtml = '';

        // 2. å¡«å…¥ã€ŒPDF ç‰ˆã€è³‡æ–™
        document.getElementById('pdfTotal').innerText = total;
        let pdfTableHtml = '';
        let pdfAdviceHtml = '';

        for (let key in questions) {
            let s = scores[key];
            let status = s >= 20 ? "å„ªè‰¯" : (s >= 11 ? "å°šå¯" : "åŠ æ²¹");
            let color = s >= 20 ? "green" : (s >= 11 ? "#d39e00" : "#d9534f");
            let advice = getAdvice(s, key);

            // è¢å¹•é¡¯ç¤º
            webAdviceHtml += `
                <div class="web-advice-item">
                    <div style="font-weight:bold; color:#333;">${questions[key].label} <span style="color:${color}">(${s}åˆ†)</span></div>
                    <div style="font-size:0.95em; color:#666;">${advice}</div>
                </div>`;

            // PDF éš±è—å±¤å¡«å……
            pdfTableHtml += `
                <tr>
                    <td>${questions[key].label}</td>
                    <td style="font-weight:bold; font-size:1.2em;">${s}</td>
                    <td style="color:${color}; font-weight:bold;">${status}</td>
                </tr>`;
            
            pdfAdviceHtml += `
                <div style="margin-bottom: 20px; padding: 15px; background: #fafafa; border-left: 5px solid ${color};">
                    <div style="font-weight:bold; margin-bottom:5px;">é‡å°ã€Œ${questions[key].label}ã€(${status}) çš„å»ºè­°ï¼š</div>
                    <div style="text-align:justify; line-height:1.5;">${advice}</div>
                </div>`;
        }

        // å¯«å…¥ DOM
        document.getElementById('webAdviceList').innerHTML = webAdviceHtml;
        document.getElementById('pdfTableBody').innerHTML = pdfTableHtml;
        document.getElementById('pdfAdviceList').innerHTML = pdfAdviceHtml;

        // æ–°å¢ï¼šç¹ªè£½åœ–è¡¨
        const chartData = [scores.finance, scores.health, scores.social, scores.purpose];
        
        // éŠ·æ¯€èˆŠåœ–è¡¨ (é¿å…å ±éŒ¯)
        if(webChart) webChart.destroy();
        if(pdfChart) pdfChart.destroy();

        // åˆ‡æ›ç•«é¢
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('webReportArea').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // ç¹ªè£½ Web Chart (æœ‰å‹•ç•«)
        webChart = drawChart('webRadarChart', chartData, false);

        // ç¹ªè£½ PDF Chart (ç„¡å‹•ç•«ï¼Œç¹ªè£½åœ¨éš±è—å±¤ä¸Š)
        // æ³¨æ„ï¼šé€™è£¡æˆ‘å€‘ä¸éœ€è¦å…ˆåˆ‡æ› visibilityï¼Œå› ç‚º Chart.js å¯ä»¥åœ¨éš±è—ä½†å­˜åœ¨çš„ DOM ä¸Šç¹ªåœ–
        // åªè¦å®¹å™¨æœ‰å›ºå®šå¯¬é«˜ (æˆ‘å€‘åœ¨ CSS è¨­å®šäº† chart-container-pdf çš„å¯¬é«˜)
        pdfChart = drawChart('pdfRadarChart', chartData, true);
    }

    function downloadPDF() {
        // é¡¯ç¤ºè¼‰å…¥ä¸­
        document.getElementById('loading').style.display = 'block';

        // åµæ¸¬æ‰‹æ©Ÿ
        const isMobile = window.innerWidth < 800;

        // æŠ“å–éš±è—çš„ PDF å±¤
        const element = document.getElementById('pdfHiddenLayer');
        
        // æš«æ™‚è§£é™¤ visibility: hiddenï¼Œè®“ html2canvas æŠ“å¾—åˆ°
        // å› ç‚ºæœ‰ z-index: -999ï¼Œå®ƒæœƒè¢«ç™½è‰² container è“‹ä½ï¼Œç”¨æˆ¶çœ‹ä¸åˆ°ï¼Œä½†ç¨‹å¼æŠ“å¾—åˆ°
        element.style.visibility = 'visible';

        const opt = {
            margin:       0,
            filename:     'é€€ä¼‘æº–å‚™åº¦è¨ºæ–·å ±å‘Š.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { 
                scale: isMobile ? 1.5 : 2, 
                useCORS: true, 
                scrollY: 0,
                windowWidth: 794 
            },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            // ä¸‹è¼‰å®Œæˆå¾Œï¼Œæ¢å¾©éš±è—
            element.style.visibility = 'hidden';
            document.getElementById('loading').style.display = 'none';
        }).catch(err => {
            alert('PDF ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            element.style.visibility = 'hidden';
            document.getElementById('loading').style.display = 'none';
        });
    }

    init();
</script>

</body>
</html>
