<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ | æ‚¨çš„å°ˆå±¬CFPé¡§å•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #e9ecef;
            --bg-color: #f4f7f6;
        }
        body {
            font-family: "Microsoft JhengHei", Arial, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1, h2 { color: var(--primary-color); text-align: center; }
        
        /* è¼¸å…¥å€æ¨£å¼ */
        .input-section { margin-bottom: 20px; }
        .quadrant-box {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .quadrant-title {
            font-weight: bold;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .question-row { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: center; }
        input[type="range"] { flex: 1; margin: 0 15px; cursor: pointer; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }
        .btn:hover { background-color: #004494; }
        .btn-download { background-color: #28a745; display: none; margin-top: 15px; } /* ç¶ è‰² */

        /* === é‡é»ä¿®æ”¹ï¼šPDF å ±å‘Šå°ˆç”¨å€åŸŸ === */
        #reportCard {
            display: none; /* é è¨­éš±è— */
            border: 2px solid var(--primary-color);
            padding: 30px;
            background: white;
            margin-top: 30px;
            border-radius: 10px;
        }
        
        /* å ±å‘Šå…§çš„è¡¨æ ¼æ¨£å¼ */
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .score-table th, .score-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .score-table th { background-color: var(--primary-color); color: white; }
        .score-table tr:nth-child(even) { background-color: #f2f2f2; }
        
        /* å ±å‘Šå…§çš„è¡Œå‹•å»ºè­° */
        .action-item {
            margin-bottom: 15px;
            padding: 15px;
            background: var(--accent-color);
            border-left: 5px solid var(--primary-color);
            border-radius: 4px;
        }
        .action-title { font-weight: bold; color: #333; margin-bottom: 5px; }
        .action-text { font-size: 0.95em; color: #555; }
        
        .footer-note {
            text-align: center;
            font-size: 0.8em;
            color: #888;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç«™</h1>
    
    <div id="inputForm">
        <p style="text-align: center; color: #666;">è«‹æ»‘å‹•è©•åˆ† (0åˆ†:ä¸è¶³ ~ 5åˆ†:å……è¶³)</p>
        <div id="quizContainer"></div>
        <button type="button" class="btn" onclick="generateReport()">æŸ¥çœ‹è¨ºæ–·çµæœ</button>
    </div>

    <div id="reportCard">
        <h2 style="margin-bottom: 5px;">å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦è¨ºæ–·æ›¸</h2>
        <p style="text-align: center; color: #666; margin-bottom: 20px;">è¨ºæ–·æ—¥æœŸï¼š<span id="reportDate"></span></p>

        <div style="text-align: center; font-size: 1.5em; font-weight: bold; color: #d9534f; margin: 10px 0;">
            ç¸½åˆ†ï¼š<span id="finalTotal">0</span> / 100
        </div>

        <table class="score-table">
            <thead>
                <tr>
                    <th>æª¢æ¸¬é¢å‘</th>
                    <th>æ‚¨çš„å¾—åˆ† (æ»¿åˆ†25)</th>
                    <th>ç‹€æ…‹è©•ä¼°</th>
                </tr>
            </thead>
            <tbody id="scoreTableBody">
                </tbody>
        </table>

        <h3 style="border-bottom: 2px solid #ccc; padding-bottom: 10px;">ã€å°ˆå±¬è¡Œå‹•æ–¹é‡ã€‘</h3>
        <div id="actionPlanList">
            </div>

        <div class="footer-note">
            æœ¬å ±å‘Šç”± AI è¼”åŠ©ç³»çµ±ç”Ÿæˆï¼Œåƒ…ä¾›è¦åŠƒåƒè€ƒã€‚<br>
            è©³ç´°è³‡ç”¢é…ç½®å»ºè­°è«‹é ç´„æ‚¨çš„ CFP é¡§å•è«®è©¢ã€‚
        </div>
    </div>

    <button id="downloadBtn" class="btn btn-download" onclick="downloadPDF()">ğŸ“¥ ä¸‹è¼‰æ­¤å ±å‘Š (PDF)</button>
    
    <button id="resetBtn" class="btn" style="background-color: #6c757d; display:none; margin-top:10px;" onclick="location.reload()">ğŸ”„ é‡æ–°æ¸¬é©—</button>

</div>

<script>
    // é¡Œç›®è³‡æ–™åº«
    const questions = {
        finance: ["è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ (0åˆ†<30% | 5åˆ†>100%)", "ç·Šæ€¥é å‚™é‡‘å……è¶³åº¦ (0åˆ†<3å€‹æœˆ | 5åˆ†>6å€‹æœˆ)", "é†«ç™‚é˜²ç¦¦ä¿‚æ•¸ (0åˆ† ä¸è¶³ | 5åˆ† å……è¶³)", "è² å‚µæ­¸é›¶è¨ˆç•« (0åˆ† ç„¡è¨ˆåŠƒ | 5åˆ† ç„¡è² å‚µ)", "è³‡ç”¢é…ç½®å¤šå…ƒæ€§ (0åˆ† å–®ä¸€ | 5åˆ† å¤šå…ƒ)"],
        health: ["èº«é«”è³ªé‡æŒ‡æ•¸ (BMI) (0åˆ† ç•°å¸¸ | 5åˆ† æ¨™æº–)", "è‚Œè‚‰é‡èˆ‡è¡Œå‹•åŠ› (0åˆ† è¡°é€€ | 5åˆ† è‰¯å¥½)", "è¦å¾‹é‹å‹•ç¿’æ…£ (0åˆ† ä¸é‹å‹• | 5åˆ† æ¯é€±å¤šæ–¼ä¸‰æ¬¡))", "ç¡çœ å“è³ª (0åˆ† å°æ–¼äº”å°æ™‚ | 5åˆ† å¤šæ–¼ä¸ƒå°æ™‚)", "å®¶æ—ç—…å²è¿½è¹¤ (0åˆ† ç„¡é«”æª¢ç¿’æ…£ | 5åˆ† æ¯å¹´å®šæœŸæª¢æŸ¥)"],
        social: ["éè·å ´æœ‹å‹æ•¸é‡ (0åˆ† å°‘æ–¼ä¸‰äºº | 5åˆ† å¤šæ–¼åäºº)", "è·¨ä»£é€£çµé »ç‡ (0åˆ† ç„¡ | 5åˆ† é »ç¹)", "ç¤¾ç¾¤åƒèˆ‡åº¦ (0åˆ† å­¤ç«‹ | 5åˆ† ç©æ¥µæŠ•å…¥)", "è¦ªå¯†é—œä¿‚å¸³æˆ¶ (0åˆ† ç–é  | 5åˆ† ç·Šå¯†æ”¯æŒ)", "ç·Šæ€¥æ•‘æ´ç¶² (0åˆ† ç„¡å»ºç«‹ | 5åˆ† éš¨æ™‚å¯æ±‚åŠ©)"],
        purpose: ["èº«ä»½èªåŒåˆ‡æ› (0åˆ† ç„¡æ³• | 5åˆ† é †åˆ©è½‰æ›)", "æ™‚é–“çµæ§‹åŒ–èƒ½åŠ› (0åˆ† æ··äº‚ | 5åˆ† äº•ç„¶æœ‰åº)", "å¿ƒæµé«”é©—é »ç‡ (0åˆ† ç„¡ | 5åˆ† ç¶“å¸¸ç™¼ç”Ÿ)", "å­¸ç¿’æ–°æŠ€èƒ½æ„é¡˜ (0åˆ† ç„¡æ„é¡˜ | 5åˆ† æŒçºŒå­¸ç¿’)", "åœ“å¤¢åŸ·è¡ŒåŠ› (0åˆ† æ‹–å»¶ | 5åˆ† ç©æ¥µè¡Œå‹•)"]
    };

    // åˆå§‹åŒ–ä»‹é¢
    function init() {
        const container = document.getElementById('quizContainer');
        for (let key in questions) {
            let section = document.createElement('div');
            section.className = 'quadrant-box';
            let html = `<div class="quadrant-title">${questions[key].label}</div>`;
            
            questions[key].items.forEach(item => {
                html += `
                    <div class="question-row">
                        <span style="flex:1">${item}</span>
                        <input type="range" min="0" max="5" value="0" data-cat="${key}" oninput="this.nextElementSibling.innerText = this.value">
                        <span style="width:20px; text-align:center; font-weight:bold;">0</span>
                    </div>
                `;
            });
            section.innerHTML = html;
            container.appendChild(section);
        }
        // è¨­å®šæ—¥æœŸ
        document.getElementById('reportDate').innerText = new Date().toLocaleDateString();
    }

    // å–å¾—å»ºè­°é‚è¼¯
    function getAdvice(score, type) {
        let level = score >= 20 ? 'high' : (score >= 11 ? 'mid' : 'low');
        const logic = {
            finance: {
                low: "è­¦å ± (ç”Ÿå­˜ç„¦æ…®)ï¼šè¢«å‹•æ”¶å…¥ä¸è¶³ã€‚å„ªå…ˆåŸ·è¡Œå‚µå‹™é›ªçƒæ³•ï¼Œå­˜æ»¿3å€‹æœˆç·Šæ€¥é å‚™é‡‘ã€‚",
                mid: "è­¦å ± (è³‡ç”¢ç´¯ç©)ï¼šè³‡ç”¢è„†å¼±ã€‚ç›®æ¨™å°‡è¢«å‹•æ”¶å…¥è¦†è“‹ç‡æå‡è‡³70%ï¼Œè£œè¶³é•·ç…§ç¼ºå£ã€‚",
                high: "å„ªè‰¯ (è²¡å¯Œå‚³æ‰¿)ï¼šè²¡å‹™è‡ªç”±ã€‚å»ºè­°è«®è©¢ä¿¡è¨—èˆ‡ç¨…å‹™è¦åŠƒï¼Œç¢ºä¿è³‡ç”¢æœ‰æ•ˆå‚³æ‰¿ã€‚"
            },
            health: {
                low: "è­¦å ± (å¥åº·å´©å£)ï¼šé¢¨éšªæ¥µé«˜ã€‚ç«‹å³é ç´„å¥æª¢ï¼Œå¾æ¯å¤©æ­¥è¡Œ15åˆ†é˜é–‹å§‹ï¼Œæ¸›å°‘ç²¾ç·»ç³–ã€‚",
                mid: "è­¦å ± (äºå¥åº·)ï¼šè‚ŒåŠ›æµå¤±ä¸­ã€‚æ¯é€±éœ€å¢åŠ 2æ¬¡é˜»åŠ›è¨“ç·´ï¼Œä¸¦ç›£æ§ç¡çœ æ•¸æ“šã€‚",
                high: "å„ªè‰¯ (æ¨‚æ´»é•·å£½)ï¼šé«”æ³æ¥µä½³ã€‚æŒçºŒæŒ‘æˆ°éœ€è…¦é«”å”èª¿çš„æ–°é‹å‹•ï¼ˆå¦‚ç¶²çƒã€èˆè¹ˆï¼‰ã€‚"
            },
            social: {
                low: "è­¦å ± (å­¤å³¶æ•ˆæ‡‰)ï¼šç”Ÿæ´»å°é–‰ã€‚æ¯æœˆä¸»å‹•è¯ç¹«ä¸€ä½è€å‹ï¼Œå¼·åˆ¶åƒåŠ ä¸€å€‹å¯¦é«”ç¤¾åœ˜ã€‚",
                mid: "è­¦å ± (ç¤¾äº¤é‡çµ„)ï¼šé€£çµæ·±åº¦ä¸è¶³ã€‚æŒ‘é¸3ä½æœ‹å‹å»ºç«‹æ·±åº¦èšæœƒï¼Œå»ºç«‹ç·Šæ€¥äº’åŠ©ç¶²ã€‚",
                high: "å„ªè‰¯ (ç¤¾ç¾¤æ¨ç´)ï¼šäººè„ˆå»£é—Šã€‚å»ºè­°é€²è¡Œç¤¾äº¤æ–·æ¨é›¢ï¼Œå°ˆæ³¨æ–¼æ»‹é¤Šå¿ƒéˆçš„é—œä¿‚ã€‚"
            },
            purpose: {
                low: "è­¦å ± (å¤±å»é‡åŠ›)ï¼šè‡ªæˆ‘è¿·æƒ˜ã€‚ç·´ç¿’ä¸æè·ç¨±ä»‹ç´¹è‡ªå·±ï¼Œåˆ—å‡º10å€‹èˆˆè¶£ä½æˆæœ¬è©¦éŒ¯ã€‚",
                mid: "è­¦å ± (æ¢ç´¢å®šéŒ¨)ï¼šç¼ºä¹åŸ·è¡Œã€‚è¨­å®šå…·é«”å­¸ç¿’ç›®æ¨™ï¼Œå°‡èˆˆè¶£è½‰åŒ–ç‚ºå°å‹åƒ¹å€¼ç”¢å‡ºã€‚",
                high: "å„ªè‰¯ (è‡ªæˆ‘å¯¦ç¾)ï¼šç›®æ¨™æ¸…æ™°ã€‚å³åˆ»å•Ÿå‹•åœ“å¤¢å¤§è¨ˆç•«ï¼Œé€éæ¼”è¬›æˆ–å¯«ä½œå‚³æ‰¿æ™ºæ…§ã€‚"
            }
        };
        return logic[type][level];
    }

    // ç”Ÿæˆå ±å‘Š
    function generateReport() {
        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => {
            scores[input.dataset.cat] += parseInt(input.value);
        });

        let total = Object.values(scores).reduce((a,b)=>a+b, 0);
        document.getElementById('finalTotal').innerText = total;

        // ç”¢ç”Ÿè¡¨æ ¼å…§å®¹
        let tableHtml = '';
        let actionHtml = '';
        
        for (let key in questions) {
            let s = scores[key];
            let status = s >= 20 ? "ğŸŒŸ å„ªè‰¯" : (s >= 11 ? "âš ï¸ å°šå¯" : "ğŸ”´ åŠ æ²¹");
            let color = s >= 20 ? "green" : (s >= 11 ? "orange" : "red");
            
            // è¡¨æ ¼è¡Œ
            tableHtml += `
                <tr>
                    <td>${questions[key].label}</td>
                    <td style="font-weight:bold; font-size:1.1em;">${s}</td>
                    <td style="color:${color}; font-weight:bold;">${status}</td>
                </tr>
            `;

            // è¡Œå‹•å»ºè­°å¡
            actionHtml += `
                <div class="action-item">
                    <div class="action-title">é‡å°ã€Œ${questions[key].label}ã€çš„å»ºè­°ï¼š</div>
                    <div class="action-text">${getAdvice(s, key)}</div>
                </div>
            `;
        }

        document.getElementById('scoreTableBody').innerHTML = tableHtml;
        document.getElementById('actionPlanList').innerHTML = actionHtml;

        // UI åˆ‡æ›
        document.getElementById('inputForm').style.display = 'none'; // éš±è—è¼¸å…¥å€
        document.getElementById('reportCard').style.display = 'block'; // é¡¯ç¤ºå ±å‘Šå€
        document.getElementById('downloadBtn').style.display = 'block';
        document.getElementById('resetBtn').style.display = 'block';
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ä¸‹è¼‰ PDF (åªæŠ“å– reportCard)
    function downloadPDF() {
        const element = document.getElementById('reportCard');
        const opt = {
            margin:       10,
            filename:     'é€€ä¼‘æº–å‚™åº¦è¨ºæ–·å ±å‘Š.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        // ç‚ºäº†é¿å…æŒ‰éˆ•è¢«ä¸‹è¼‰ï¼Œå…¶å¯¦æˆ‘å€‘å·²ç¶“æŠŠ inputForm éš±è—äº†
        // åªé‡å° reportCard é€²è¡Œæˆªåœ–ï¼Œé€™æ¨£æœ€ä¹¾æ·¨
        html2pdf().set(opt).from(element).save();
    }

    init();
</script>

</body>
</html>
