<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ | CFP åœ‹éš›ç†è²¡é¡§å• æ—é¦¬ä¸è£½ä½œ</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary-color: #0056b3; --accent-color: #f8f9fa; --bg-color: #f4f7f6; --orange-brand: #e65100; }
        body { font-family: "Microsoft JhengHei", "Heiti TC", sans-serif; background-color: var(--bg-color); color: #333; margin: 0; padding: 20px; overflow-x: hidden; }

        /* === Web View UI === */
        #mobileAppLayer { display: block; max-width: 800px; margin: 0 auto; background: #ffffff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .app-box { border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .app-title { font-size: 1.25em; font-weight: bold; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; margin-bottom: 15px; }
        .app-btn { display: block; width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 1.15em; margin-top: 15px; cursor: pointer; transition: 0.2s; font-weight: bold; text-align:center; text-decoration:none; }
        .app-btn:active { transform: scale(0.98); }
        
        .user-info-box { background: #e9f5ff; border: 2px solid #b8daff; padding: 20px; border-radius: 10px; margin-bottom: 25px; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; font-weight: bold; margin-bottom: 8px; color: #0056b3; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; box-sizing: border-box; }

        .question-row { display: flex; flex-direction: column; margin-bottom: 18px; padding-bottom: 10px; border-bottom: 1px dashed #eee; }
        .input-wrapper { display: flex; align-items: center; margin-top: 10px; }
        input[type="range"] { flex: 1; margin: 0 10px; height: 35px; cursor: pointer; }
        @media(min-width: 600px) { .question-row { flex-direction: row; justify-content: space-between; align-items: flex-start; } .input-wrapper { margin-top: 0; width: 45%; } }

        /* === PDF è¼¸å‡ºå±¤ (æ ¸å¿ƒå®šä½é–å®š) === */
        #pdfPrintLayer { display: none; width: 794px !important; min-width: 794px !important; margin: 0; background: #ffffff; position: absolute; left: 0; top: 0; z-index: -1; }
        .pdf-page { width: 794px; height: 1080px; padding: 50px 60px; box-sizing: border-box; background: white; position: relative; overflow: hidden; border-bottom: 1px solid #eee; }
        .pdf-table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        .pdf-table th, .pdf-table td { border: 1px solid #333; padding: 12px; text-align: center; font-size: 14px; }
        .pdf-table th { background: var(--primary-color); color: white; }
        .chart-box-pdf { position: relative; width: 550px; height: 450px; margin: 20px auto; }
        .page-footer { position: absolute; bottom: 40px; width: 100%; left: 0; text-align: center; color: #999; font-size: 12px; }

        #loadingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); color: white; z-index: 200000; text-align: center; padding-top: 40vh; }
        #mobileDownloadModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200001; justify-content: center; align-items: center; }
        .modal-box { background: white; width: 85%; max-width: 350px; padding: 30px; border-radius: 15px; text-align: center; }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div style="font-size:3em; margin-bottom:15px;">ğŸ“Š</div>
    <div style="font-size:1.2em; font-weight:bold;">æ—é¦¬ä¸é¡§å•ç³»çµ±ï¼šæ­£åœ¨ç²¾ç®—æ•¸æ“šä¸¦æ’ç‰ˆ...</div>
</div>

<div id="mobileDownloadModal">
    <div class="modal-box">
        <h2 style="color:#333;">å ±å‘Šè£½ä½œå®Œæˆï¼</h2>
        <a id="blobDownloadLink" class="app-btn" style="background:#28a745;" target="_blank">ğŸ“¥ ä¸‹è¼‰å®Œæ•´ PDF å ±å‘Š</a>
        <button onclick="closeModal()" style="margin-top:18px; border:none; background:none; color:#999; text-decoration:underline;">é—œé–‰</button>
    </div>
</div>

<div id="mobileAppLayer">
    <div id="inputSection">
        <h1 style="color:var(--primary-color); text-align:center;">é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç«™</h1>
        <div class="user-info-box">
            <h3 style="margin-top:0; color:#0056b3;">ğŸ“ æª¢æ¸¬è€…ç™»éŒ„</h3>
            <div class="form-group"><label class="form-label">æ‚¨çš„å§“åï¼š</label><input type="text" id="userName" class="form-input" placeholder="è«‹è¼¸å…¥å§“å"></div>
            <div class="form-group"><label class="form-label">è¯çµ¡é›»è©± (é¸å¡«)ï¼š</label><input type="tel" id="userPhone" class="form-input" placeholder="ä¾‹å¦‚ï¼š0912-345-678"></div>
        </div>
        <div id="quizContainer"></div>
        <button class="app-btn" onclick="submitAndShowResults()">æŸ¥çœ‹æˆ‘çš„è¨ºæ–·çµæœ</button>
    </div>
    
    <div id="resultSection" style="display:none;">
        <h2 style="text-align:center; color:var(--primary-color);">è¨ºæ–·åˆ†æçµæœ</h2>
        <p id="welcomeUser" style="text-align:center; font-weight:bold;"></p>
        <div style="background: var(--accent-color); padding: 25px; text-align: center; border-radius: 10px; margin-bottom: 25px; border: 1px solid #ddd;">
            <div style="font-size:1.1em; color:#555;">é€€ä¼‘äº”åŠ›æ ¸å¿ƒå¾—åˆ†</div>
            <div style="font-size: 4em; font-weight: bold; color: #d9534f;" id="webTotal">0</div>
        </div>

        <div id="emailCaptureZone" style="background: linear-gradient(135deg, #fff5e6 0%, #fff 100%); border: 2px solid #ff9800; padding: 20px; border-radius: 15px; margin: 25px 0;">
            <h3 style="color:#e65100; margin-top:0;">ğŸ“© é ˜å–å¹´é½¡å°ˆå±¬ç™½çš®æ›¸</h3>
            <p style="font-size:0.9em; color:#5d4037; line-height:1.6;"><b>CFP åœ‹éš›ç†è²¡é¡§å• æ—é¦¬ä¸</b> å°‡æ ¹æ“šæ‚¨çš„å¹´é½¡å€æ®µï¼Œå¯„é€å°ˆå±¬çš„ã€Šé€€ä¼‘è²¡å‹™ç¼ºå£æª¢æŸ¥æ¸…å–®ã€‹ã€‚</p>
            <select id="userAge" class="form-input" style="margin-bottom:12px;">
                <option value="30-40">30-40 æ­² (è³‡ç”¢è¡åˆºæœŸ)</option>
                <option value="41-50">41-50 æ­² (é»ƒé‡‘å¤¾å¿ƒæœŸ)</option>
                <option value="51-60">51-60 æ­² (é€€ä¼‘æº–å‚™æœŸ)</option>
                <option value="61+">61 æ­²ä»¥ä¸Š (æ¨‚æ´»äº«å—æœŸ)</option>
            </select>
            <div style="display:flex; gap:10px;">
                <input type="email" id="userEmail" class="form-input" placeholder="è«‹è¼¸å…¥ Email">
                <button onclick="sendEmailReport()" id="emailBtn" style="background:#e65100; color:white; border:none; padding:0 15px; border-radius:8px; font-weight:bold; cursor:pointer;">ç™¼é€</button>
            </div>
            <div id="emailStatus" style="font-size:0.85em; margin-top:10px; font-weight:bold; display:none;"></div>
        </div>

        <div id="webAdviceList"></div>
        <div class="chart-box-web" style="height:320px; margin:30px 0;"><canvas id="webRadarChart"></canvas></div>

        <div style="background: #fff8e1; border: 2px solid #ffecb3; padding: 20px; border-radius: 12px; margin-bottom:30px; text-align: center;">
            <h4 style="color: #bf360c; margin-top:0;">ğŸ’¡ å°ˆæ¥­å»ºè­°èˆ‡è§£è®€</h4>
            <a href="https://calendar.app.google/2spQUa1xxirEUKPK8" target="_blank" style="color: #3e2723; font-weight:bold; text-decoration:underline;">ğŸ“… é»æ­¤é ç´„æ—é¦¬ä¸é¡§å• 30 åˆ†é˜å¥è¨º</a>
        </div>

        <button class="app-btn" style="background:#28a745;" onclick="processPDF()">ğŸ“¥ ä¸‹è¼‰æ­£å¼ PDF å ±å‘Šæ›¸</button>
        <button class="app-btn" style="background:#6c757d; margin-top:15px;" onclick="location.reload()">ğŸ”„ é‡æ–°æ¸¬é©—</button>
    </div>
</div>

<div id="pdfPrintLayer">
    <div class="pdf-page">
        <h2 style="text-align:center; color:#0056b3; font-size:28px;">é€€ä¼‘æº–å‚™åº¦å°ˆæ¥­è¨ºæ–·æ›¸</h2>
        <p style="text-align:right; font-size:12px; color:#666;">CFP åœ‹éš›ç†è²¡é¡§å• æ—é¦¬ä¸ å°ˆæ¥­ç›£è£½ | <span id="pdfDate"></span></p>
        <div style="text-align:center; margin-top:40px;">
            <p style="font-size:20px; font-weight:bold;">å—æ¸¬è€…ï¼š<span id="pdfUserName"></span></p>
        </div>
        <div style="text-align:center; background:#f8f9fa; padding:40px; margin:40px 50px; border-radius:20px; border:1px solid #ddd;">
            <div style="font-size:1.2em; color:#555;">ç¶œåˆå¾—åˆ†</div>
            <div style="font-size:6em; font-weight:bold; color:#d9534f; line-height:1;" id="pdfTotal">0</div>
        </div>
        <table class="pdf-table">
            <thead><tr><th width="40%">æª¢æ¸¬é¢å‘</th><th width="20%">å¾—åˆ†</th><th width="40%">ç‹€æ…‹è©•ä¼°</th></tr></thead>
            <tbody id="pdfTableBody"></tbody>
        </table>
        <div class="page-footer">- ç¬¬ 1 é  -</div>
    </div>
    <div class="pdf-page">
        <h3 style="color:#0056b3; border-left:8px solid #0056b3; padding-left:15px;">ç¬¬äºŒéƒ¨åˆ†ï¼šå°ˆå±¬è¡Œå‹•æ–¹é‡</h3>
        <div id="pdfAdviceList" style="margin-top: 30px;"></div>
        <div class="page-footer">- ç¬¬ 2 é  -</div>
    </div>
    <div class="pdf-page">
        <h3 style="color:#0056b3; border-left:8px solid #0056b3; padding-left:15px;">ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº”åŠ›åˆ†æé›·é”åœ–</h3>
        <div class="chart-box-pdf"><canvas id="pdfRadarChart"></canvas></div>
        <div style="text-align:center; margin-top:100px; padding:20px; border:1px solid #eee; background:#fafafa; border-radius:10px;">
            <p><strong>æœ¬è¨ºæ–·ç”±ã€Œæ—é¦¬ä¸é€€ä¼‘ç²¾ç®—ç³»çµ±ã€ç”Ÿæˆ</strong></p>
            <p style="font-size:12px; color:#666;">è²¡å‹™è¦åŠƒå…·æ™‚æ•ˆæ€§ï¼Œå»ºè­°å®šæœŸå›æ¸¬ä¸¦èˆ‡æ‚¨çš„ CFP é¡§å•è¨è«–ã€‚</p>
        </div>
        <div class="page-footer">- ç¬¬ 3 é  -</div>
    </div>
</div>

<script>
    // === æ ¸å¿ƒé…ç½® ===
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyT-p9PEm0y3axjz6oXvYFORBDSQxCqJq_4RrLYdXeko5JHyudkpPuRrSkHaTAwXNLD/exec';

    // å®Œæ•´çš„é¡Œç›®èˆ‡è©³ç´°è¨»è§£ (V56 åŸå§‹è¦æ ¼)
    const questions = {
        finance: { label: "è²¡å‹™åŸºç«™", items: ["è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ (0åˆ†<30% | 5åˆ†>100%)", "ç·Šæ€¥é å‚™é‡‘å……è¶³åº¦ (0åˆ†<3å€‹æœˆ | 5åˆ†>6å€‹æœˆ)", "é†«ç™‚é˜²ç¦¦ä¿‚æ•¸ (0åˆ† ä¸è¶³ | 5åˆ† å……è¶³)", "è² å‚µæ­¸é›¶è¨ˆç•« (0åˆ† ç„¡è¨ˆåŠƒ | 5åˆ† ç„¡è² å‚µ)", "è³‡ç”¢é…ç½®å¤šå…ƒæ€§ (0åˆ† å–®ä¸€ | 5åˆ† å¤šå…ƒ)"] },
        health: { label: "èº«å¿ƒçºŒèˆª", items: ["èº«é«”è³ªé‡æŒ‡æ•¸ (BMI) (0åˆ† ç•°å¸¸ | 5åˆ† æ¨™æº–)", "è‚Œè‚‰é‡èˆ‡è¡Œå‹•åŠ› (0åˆ† è¡°é€€ | 5åˆ† è‰¯å¥½)", "è¦å¾‹é‹å‹•ç¿’æ…£ (0åˆ† ä¸é‹å‹• | 5åˆ† æ¯é€±å¤šæ–¼ä¸‰æ¬¡)", "ç¡çœ å“è³ª (0åˆ† å°æ–¼äº”å°æ™‚ | 5åˆ† å¤šæ–¼ä¸ƒå°æ™‚)", "å®¶æ—ç—…å²è¿½è¹¤ (0åˆ† ç„¡é«”æª¢ç¿’æ…£ | 5åˆ† æ¯å¹´å®šæœŸæª¢æŸ¥)"] },
        social: { label: "ç¤¾äº¤æ¼«éŠ", items: ["éè·å ´æœ‹å‹æ•¸é‡ (0åˆ† å°‘æ–¼ä¸‰äºº | 5åˆ† å¤šæ–¼åäºº)", "è·¨ä»£é€£çµé »ç‡ (0åˆ† ç„¡ | 5åˆ† é »ç¹)", "ç¤¾ç¾¤åƒèˆ‡åº¦ (0åˆ† å­¤ç«‹ | 5åˆ† ç©æ¥µæŠ•å…¥)", "è¦ªå¯†é—œä¿‚å¸³æˆ¶ (0åˆ† ç–é  | 5åˆ† ç·Šå¯†æ”¯æŒ)", "ç·Šæ€¥æ•‘æ´ç¶² (0åˆ† ç„¡å»ºç«‹ | 5åˆ† éš¨æ™‚å¯æ±‚åŠ©)"] },
        purpose: { label: "ç¬¬äºŒäººç”Ÿ", items: ["èº«ä»½èªåŒåˆ‡æ› (0åˆ† ç„¡æ³• | 5åˆ† é †åˆ©è½‰æ›)", "æ™‚é–“çµæ§‹åŒ–èƒ½åŠ› (0åˆ† æ··äº‚ | 5åˆ† äº•ç„¶æœ‰åº)", "å¿ƒæµé«”é©—é »ç‡ (0åˆ† ç„¡ | 5åˆ† ç¶“å¸¸ç™¼ç”Ÿ)", "å­¸ç¿’æ–°æŠ€èƒ½æ„é¡˜ (0åˆ† ç„¡æ„é¡˜ | 5åˆ† æŒçºŒå­¸ç¿’)", "åœ“å¤¢åŸ·è¡ŒåŠ› (0åˆ† æ‹–å»¶ | 5åˆ† ç©æ¥µè¡Œå‹•)"] }
    };

    // å®Œæ•´çš„å»ºè­°é‚è¼¯ (V56 åŸå§‹è¦æ ¼ï¼Œçµ•ç„¡åˆªæ¸›)
    function getAdvice(score, type) {
        const logic = {
            finance: { 
                low: "ç”Ÿå­˜ç„¦æ…®æœŸï¼šè¢«å‹•æ”¶å…¥åš´é‡ä¸è¶³ã€‚å»ºè­°å„ªå…ˆåŸ·è¡Œå‚µå‹™é›ªçƒæ³•ï¼Œä¸¦å¼·åˆ¶å­˜æ»¿3å€‹æœˆç·Šæ€¥é å‚™é‡‘ã€‚", 
                mid: "è³‡ç”¢ç´¯ç©æœŸï¼šè³‡ç”¢æŠ—é€šè†¨åŠ›è„†å¼±ã€‚å»ºè­°å°‡è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ç›®æ¨™è¨­ç‚º70%ï¼Œä¸¦è£œè¶³é†«ç™‚ç¼ºå£ã€‚", 
                high: "è²¡å¯Œå‚³æ‰¿æœŸï¼šè²¡å‹™è‡ªç”±ã€‚å»ºè­°è«®è©¢ä¿¡è¨—æ¶æ§‹æˆ–ç¨…å‹™è¦åŠƒï¼Œç¢ºä¿è³‡ç”¢èƒ½ä¾æ‚¨çš„æ„é¡˜å‚³æ‰¿ã€‚" 
            },
            health: { 
                low: "å¥åº·å´©å£æœŸï¼šé€€ä¼‘æœ€å¤§éš±æ†‚ã€‚è«‹ç«‹å³é ç´„å¥æª¢ï¼Œä¸¦å¾ã€Œæ¯å¤©æ­¥è¡Œ15åˆ†é˜ã€èˆ‡æ¸›ç³–é£²é£Ÿé–‹å§‹ã€‚", 
                mid: "äºå¥åº·èª¿æ•´æœŸï¼šè‚ŒåŠ›æœ‰æµå¤±é¢¨éšªã€‚å»ºè­°æ¯é€±è‡³å°‘2æ¬¡é˜»åŠ›è¨“ç·´ï¼Œä¸¦é…æˆ´è£ç½®ç›£æ§ç¡çœ ã€‚", 
                high: "æ¨‚æ´»é•·å£½æœŸï¼šé«”æ³æ¥µä½³ã€‚å»ºè­°æŒçºŒæŒ‘æˆ°éœ€ã€Œè…¦é«”å”èª¿ã€çš„æ–°é‹å‹•ï¼ˆå¦‚ç¶²çƒã€èˆè¹ˆï¼‰ã€‚" 
            },
            social: { 
                low: "å­¤å³¶æ•ˆæ‡‰æœŸï¼šç”Ÿæ´»åœˆå°é–‰ã€‚å»ºè­°æ¯æœˆä¸»å‹•è¯ç¹«ä¸€ä½è€å‹ï¼Œä¸¦å¼·åˆ¶è‡ªå·±åƒåŠ ä¸€å€‹å¯¦é«”èˆˆè¶£ç¤¾åœ˜ã€‚", 
                mid: "ç¤¾äº¤é‡çµ„æœŸï¼šé€£çµæ·±åº¦ä¸è¶³ã€‚å»ºè­°æŒ‘é¸3ä½æœ‹å‹å»ºç«‹æ·±åº¦èšæœƒï¼Œä¸¦å»ºç«‹ç·Šæ€¥äº’åŠ©è¯çµ¡ç¶²ã€‚", 
                high: "ç¤¾ç¾¤æ¨ç´æœŸï¼šäººè„ˆå»£é—Šã€‚å»ºè­°é€²è¡Œç¤¾äº¤æ–·æ¨é›¢ï¼Œå°‡æ™‚é–“ç•™çµ¦çœŸæ­£æ»‹é¤Šå¿ƒéˆçš„æ·±åº¦é—œä¿‚ã€‚" 
            },
            purpose: { 
                low: "å¤±å»é‡åŠ›æœŸï¼šè‡ªæˆ‘åƒ¹å€¼è¿·æƒ˜ã€‚è«‹ç·´ç¿’ã€Œä¸æè·ç¨±ã€ä»‹ç´¹è‡ªå·±ï¼Œåˆ—å‡º10å€‹èˆˆè¶£é€²è¡Œä½æˆæœ¬è©¦éŒ¯ã€‚", 
                mid: "æ¢ç´¢å®šéŒ¨æœŸï¼šç¼ºä¹åŸ·è¡ŒåŠ›ã€‚è«‹è¨­å®šå…·é«”çš„å­¸ç¿’ç›®æ¨™ï¼ˆå¦‚è€ƒè­‰ç…§ï¼‰ï¼Œå°‡èˆˆè¶£è½‰åŒ–ç‚ºç”¢å‡ºã€‚", 
                high: "è‡ªæˆ‘å¯¦ç¾æœŸï¼šç›®æ¨™æ¸…æ™°ã€‚è«‹å³åˆ»å•Ÿå‹•åœ“å¤¢å¤§è¨ˆç•«ï¼Œæˆ–é€éå¯«ä½œã€æ¼”è¬›åˆ†äº«äººç”Ÿæ™ºæ…§ã€‚" 
            }
        };
        let level = score >= 20 ? 'high' : (score >= 11 ? 'mid' : 'low');
        return logic[type][level];
    }

    let webChart = null, pdfChart = null, currentData = [];

    function init() {
        const container = document.getElementById('quizContainer');
        for (let key in questions) {
            let section = document.createElement('div'); 
            section.className = 'app-box';
            section.innerHTML = `<div class="app-title">${questions[key].label}</div>`;
            questions[key].items.forEach(item => {
                section.innerHTML += `
                    <div class="question-row">
                        <span style="font-size:0.95em;">${item}</span>
                        <div class="input-wrapper">
                            <input type="range" min="0" max="5" value="0" data-cat="${key}" oninput="this.nextElementSibling.innerText = this.value">
                            <span style="font-weight:bold; margin-left:10px; width:25px; text-align:center;">0</span>
                        </div>
                    </div>`;
            });
            container.appendChild(section);
        }
        document.getElementById('pdfDate').innerText = new Date().toLocaleDateString();
    }

    async function submitAndShowResults() {
        const name = document.getElementById('userName').value.trim();
        if (!name) { alert("è«‹å¡«å¯«å§“åä»¥åˆ©å ±å‘Šç”Ÿæˆã€‚"); return; }
        document.getElementById('loadingOverlay').style.display = 'block';

        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => { scores[input.dataset.cat] += parseInt(input.value); });
        currentData = [scores.finance, scores.health, scores.social, scores.purpose];
        const total = currentData.reduce((a,b)=>a+b, 0);

        // èƒŒæ™¯å‚³é€å­˜æª”
        fetch(GOOGLE_SCRIPT_URL, { 
            method: "POST", 
            mode: 'no-cors', 
            body: JSON.stringify({ name, phone: document.getElementById('userPhone').value, ...scores, total }) 
        });

        document.getElementById('webTotal').innerText = total;
        document.getElementById('pdfTotal').innerText = total;
        document.getElementById('pdfUserName').innerText = name;
        document.getElementById('welcomeUser').innerText = `ä½ å¥½ï¼Œ${name}ï¼æ‚¨çš„å°ˆæ¥­åˆ†æçµæœå·²å°±ç·’ï¼š`;

        let adviceHtml = '', pdfTable = '', pdfAdvice = '';
        for(let key in questions) {
            let s = scores[key];
            let color = s>=20?"#28a745":(s>=11?"#d39e00":"#d9534f");
            let status = s>=20?"å„ªè‰¯":(s>=11?"å°šå¯":"éœ€åŠ å¼·");
            
            adviceHtml += `<div style="border-left:5px solid ${color}; padding:10px; margin-bottom:10px; background:#fff;"><b>${questions[key].label}</b>: ${getAdvice(s, key)}</div>`;
            pdfTable += `<tr><td>${questions[key].label}</td><td style="font-weight:bold;">${s}</td><td style="color:${color};font-weight:bold">${status}</td></tr>`;
            pdfAdvice += `<div style="margin-bottom:15px; padding:15px; background:#f9f9f9; border-left:6px solid ${color}; font-size:14px;"><b>${questions[key].label} (${status})</b><br>${getAdvice(s, key)}</div>`;
        }
        document.getElementById('webAdviceList').innerHTML = adviceHtml;
        document.getElementById('pdfTableBody').innerHTML = pdfTable;
        document.getElementById('pdfAdviceList').innerHTML = pdfAdvice;

        if(webChart) webChart.destroy();
        webChart = createChart('webRadarChart', currentData, false);

        setTimeout(() => {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'block';
            window.scrollTo(0,0);
        }, 1200);
    }

    async function sendEmailReport() {
        const email = document.getElementById('userEmail').value.trim();
        const btn = document.getElementById('emailBtn');
        if (!email.includes('@')) { alert("Email æ ¼å¼éŒ¯èª¤"); return; }
        btn.disabled = true; btn.innerText = "...";
        try {
            await fetch(GOOGLE_SCRIPT_URL, { 
                method: "POST", 
                mode: 'no-cors', 
                body: JSON.stringify({ 
                    action: "send_email", 
                    name: document.getElementById('userName').value, 
                    email, 
                    age: document.getElementById('userAge').value, 
                    total: currentData.reduce((a,b)=>a+b,0) 
                }) 
            });
            document.getElementById('emailStatus').innerText = "âœ… ç™½çš®æ›¸å·²é ç´„å¯„é€è‡³æ‚¨çš„ä¿¡ç®±ï¼";
            document.getElementById('emailStatus').style.display = "block";
        } catch (e) { 
            btn.disabled = false; btn.innerText = "é‡ç™¼"; 
        }
    }

    function createChart(canvasId, data, isPdf) {
        const ctx = document.getElementById(canvasId).getContext('2d');
        return new Chart(ctx, {
            type: 'radar',
            data: { 
                labels: ['è²¡å‹™', 'å¥åº·', 'ç¤¾äº¤', 'äººç”Ÿ'], 
                datasets: [{ 
                    data: data, 
                    backgroundColor: 'rgba(0,86,179,0.2)', 
                    borderColor: '#0056b3', 
                    borderWidth: 2, 
                    pointRadius: isPdf?5:3 
                }] 
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                animation: isPdf?false:{duration:1000}, 
                scales: { r: { suggestedMin: 0, suggestedMax: 25, ticks: { display: false } } }, 
                plugins: { legend: { display: false } } 
            }
        });
    }

    // === V57.2 æ­£å¼ä¿®æ­£ï¼šé›»è…¦ç‰ˆä¸è£åˆ‡ + æ‰‹æ©Ÿ Web Share ===
    async function processPDF() {
        document.getElementById('loadingOverlay').style.display = 'block';
        window.scrollTo(0, 0); 
        await new Promise(r => setTimeout(r, 400));

        const originalWidth = document.body.style.width;
        
        try {
            document.body.style.width = '794px';
            const pdfLayer = document.getElementById('pdfPrintLayer');
            document.getElementById('mobileAppLayer').style.display = 'none';
            pdfLayer.style.display = 'block';

            if(pdfChart) pdfChart.destroy();
            await new Promise(r => setTimeout(r, 100));
            pdfChart = createChart('pdfRadarChart', currentData, true);
            await new Promise(r => setTimeout(r, 1200)); // çµ¦äºˆå……è¶³åœ–è¡¨ç¹ªè£½æ™‚é–“

            const opt = {
                margin: 0, 
                filename: `é€€ä¼‘æº–å‚™åº¦å ±å‘Š_${Date.now()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true, 
                    windowWidth: 794, 
                    width: 794,
                    x: 0, 
                    y: 0, 
                    scrollX: 0, 
                    scrollY: 0 // åº§æ¨™é–æ­»ï¼Œè§£æ±ºé›»è…¦ç‰ˆè£åˆ‡
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            const isPhone = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (isPhone) {
                const blob = await html2pdf().set(opt).from(pdfLayer).output('blob');
                const file = new File([blob], "é€€ä¼‘è¨ºæ–·å ±å‘Š.pdf", { type: "application/pdf" });
                restoreUI(originalWidth);
                if (navigator.share) {
                    await navigator.share({ files: [file], title: 'æ‚¨çš„é€€ä¼‘è¨ºæ–·å ±å‘Š' });
                } else {
                    document.getElementById('blobDownloadLink').href = URL.createObjectURL(blob);
                    document.getElementById('mobileDownloadModal').style.display = 'flex';
                }
            } else {
                await html2pdf().set(opt).from(pdfLayer).save();
                restoreUI(originalWidth);
            }
        } catch (e) { 
            alert("PDF ç”Ÿæˆç•°å¸¸ï¼Œè«‹é‡æ–°å˜—è©¦ã€‚"); 
            restoreUI(originalWidth); 
        }
    }

    function restoreUI(width) {
        document.body.style.width = width || '';
        document.getElementById('pdfPrintLayer').style.display = 'none';
        document.getElementById('mobileAppLayer').style.display = 'block';
        document.getElementById('loadingOverlay').style.display = 'none';
        window.scrollTo(0, 0);
    }
    function closeModal() { document.getElementById('mobileDownloadModal').style.display = 'none'; }
    init();
</script>
</body>
</html>
