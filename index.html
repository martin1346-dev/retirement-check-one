<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ | æ‚¨çš„å°ˆå±¬CFPé¡§å• æ—é¦¬ä¸è£½ä½œ</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #f8f9fa;
            --bg-color: #f4f7f6;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
            /* é¿å…æ©«å‘æ»¾å‹•å¹²æ“¾ */
            overflow-x: hidden;
        }

        /* === æ‰‹æ©Ÿæ“ä½œä»‹é¢ === */
        #mobileAppLayer {
            display: block;
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* === PDF åˆ—å°ä»‹é¢ === */
        /* å¹³å¸¸éš±è—ï¼Œä¸‹è¼‰æ™‚æœƒè¢« JS é¡¯ç¤ºå‡ºä¾† */
        #pdfPrintLayer {
            display: none; 
            width: 794px; /* A4 å¯¬åº¦ */
            margin: 0 auto; 
            background: #525659; /* é è¦½æ™‚çš„æ·±è‰²åº• */
            padding: 20px 0;
        }

        /* å–®é å®¹å™¨ï¼šåš´æ ¼é–å®šï¼Œé˜²æ­¢é›»è…¦ç‰ˆå¤šå‡ºç©ºç™½é  */
        .pdf-page {
            width: 794px;
            /* é—œéµï¼šA4 é«˜åº¦ 1123pxï¼Œè¨­å®š 1080px ç•™å‡ºç·©è¡ï¼Œç¢ºä¿çµ•ä¸æº¢å‡º */
            height: 1080px; 
            padding: 50px 60px;
            box-sizing: border-box;
            background: white;
            position: relative;
            /* å…§å®¹è‹¥è¶…å‡ºç›´æ¥åˆ‡æ‰ï¼Œé˜²æ­¢æ’å‡ºç¬¬ 4 é  */
            overflow: hidden; 
            margin-bottom: 20px; /* é èˆ‡é çš„é–“è· */
        }

        /* === UI å…ƒä»¶ === */
        h1 { color: var(--primary-color); text-align: center; margin-bottom: 20px; }
        .btn { display: block; width: 100%; padding: 15px; background: var(--primary-color); color: white; border: none; border-radius: 5px; font-size: 1.2em; margin-top: 25px; cursor: pointer; }
        .quadrant-box { background: #fafafa; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .quadrant-title { font-weight: bold; color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 8px; margin-bottom: 12px; font-size: 1.1em; }
        .question-row { display: flex; flex-direction: column; margin-bottom: 12px; }
        .input-wrapper { display: flex; align-items: center; margin-top: 5px; }
        input[type="range"] { flex: 1; margin: 0 10px; height: 30px; cursor: pointer; }
        @media(min-width: 600px) { 
            .question-row { flex-direction: row; justify-content: space-between; align-items: center; }
            .input-wrapper { margin-top: 0; width: 50%; }
        }

        .web-score-card { background: var(--accent-color); padding: 25px; text-align: center; border-radius: 10px; margin-bottom: 25px; }
        .web-advice-item { border-left: 5px solid var(--primary-color); background: #fff; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .chart-box-web { position: relative; height: 300px; width: 100%; max-width: 500px; margin: 30px auto; }
        
        /* PDF ç¬¬ä¸‰é å°ˆç”¨å¤§åœ– */
        .chart-box-pdf { 
            position: relative; 
            width: 650px; 
            height: 500px; 
            margin: 40px auto; 
            display: block;
        }

        .pdf-table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 16px; }
        .pdf-table th, .pdf-table td { border: 1px solid #333; padding: 15px; text-align: center; }
        .pdf-table th { background: var(--primary-color); color: white; }
        
        /* ä¸‹è¼‰é®ç½© */
        #loadingOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.92); color: white; z-index: 100000;
            text-align: center; padding-top: 40vh;
        }
        
        .page-footer {
            position: absolute; bottom: 40px; width: 100%; left: 0;
            text-align: center; color: #999; font-size: 12px;
        }
    </style>
</head>
<body>

<div id="loadingOverlay">
    <div style="font-size:3em; margin-bottom:15px;">â³</div>
    <div style="font-size:1.2em; font-weight:bold;">æ­£åœ¨å»ºç«‹æª”æ¡ˆ...</div>
    <div style="font-size:0.9em; color:#ccc; margin-top:10px;">(æ‰‹æ©Ÿç‰ˆè«‹ç¨å€™ï¼Œå°‡é–‹å•Ÿæ–°è¦–çª—)</div>
</div>

<div id="mobileAppLayer">
    <div id="inputSection">
        <h1>é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç«™</h1>
        <p style="text-align:center; color:#666; margin-bottom:20px;">è«‹ä¾ç¾æ³è©•åˆ† (0åˆ†:ä¸è¶³ ~ 5åˆ†:å……è¶³)</p>
        <div id="quizContainer"></div>
        <button class="btn" onclick="showWebResults()">æŸ¥çœ‹è¨ºæ–·çµæœ</button>
    </div>

    <div id="resultSection" style="display:none;">
        <h2>è¨ºæ–·çµæœç¸½è¦½</h2>
        <div class="web-score-card">
            <div style="font-size:1.1em; color:#555;">ç¶œåˆè©•ä¼°å¾—åˆ†</div>
            <div style="font-size: 3.5em; font-weight: bold; color: #d9534f; line-height:1.2;" id="webTotal">0</div>
            <div style="font-size:0.9em; color:#888;">/ 100</div>
        </div>
        
        <div id="webAdviceList"></div>

        <h3 style="text-align:center; color:#555; margin-top:40px;">ã€äº”åŠ›åˆ†æé›·é”åœ–ã€‘</h3>
        <div class="chart-box-web">
            <canvas id="webRadarChart"></canvas>
        </div>

        <div style="text-align:center; margin-top:40px; margin-bottom:20px;">
            <p style="color:#0056b3; font-weight:bold; margin-bottom:10px;">æƒ³ä¿å­˜é€™ä»½åˆ†æå ±å‘Šå—ï¼Ÿ</p>
            <button class="btn" style="background:#28a745; margin-top:0;" onclick="startPdfProcess()">ğŸ“¥ å–å¾— PDF å ±å‘Š</button>
            <button class="btn" style="background:#6c757d;" onclick="location.reload()">ğŸ”„ é‡æ–°æ¸¬é©—</button>
        </div>
    </div>
</div>

<div id="pdfPrintLayer">
    
    <div class="pdf-page">
        <h2 style="text-align:center; color:#0056b3; margin-top:10px; font-size: 28px;">å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦è¨ºæ–·æ›¸</h2>
        <p style="text-align:right; color:#666; font-size: 14px;">è¨ºæ–·æ—¥æœŸï¼š<span id="pdfDate"></span></p>
        <div style="text-align:center; background:#f8f9fa; padding:25px; margin:30px 50px; border-radius:15px;">
            <div style="font-size:1.5em; color:#555;">ç¶œåˆè©•ä¼°å¾—åˆ†</div>
            <div style="font-size:6em; font-weight:bold; color:#d9534f; line-height:1;" id="pdfTotal">0</div>
        </div>
        <h3 style="color:#0056b3; border-left:6px solid #0056b3; padding-left:12px; margin-top:50px; font-size: 20px;">ç¬¬ä¸€éƒ¨åˆ†ï¼šè©³ç´°å¾—åˆ†</h3>
        <table class="pdf-table">
            <thead><tr><th width="40%">æª¢æ¸¬é¢å‘</th><th width="20%">å¾—åˆ†</th><th width="40%">ç‹€æ…‹è©•ä¼°</th></tr></thead>
            <tbody id="pdfTableBody"></tbody>
        </table>
        <div class="page-footer">- ç¬¬ 1 é  / å…± 3 é  -</div>
    </div>

    <div class="pdf-page">
        <h3 style="color:#0056b3; border-left:6px solid #0056b3; padding-left:12px; margin-top:10px; font-size: 20px;">ç¬¬äºŒéƒ¨åˆ†ï¼šå°ˆå±¬è¡Œå‹•æ–¹é‡</h3>
        <div id="pdfAdviceList" style="margin-top: 30px;"></div>
        <div class="page-footer">- ç¬¬ 2 é  / å…± 3 é  -</div>
    </div>

    <div class="pdf-page">
        <h3 style="color:#0056b3; border-left:6px solid #0056b3; padding-left:12px; margin-top:10px; font-size: 20px;">ç¬¬ä¸‰éƒ¨åˆ†ï¼šäº”åŠ›åˆ†æè¦–è¦ºåŒ–</h3>
        <div style="text-align:center; margin-top: 40px; color:#666; font-size: 16px;">ä¸‹åœ–å±•ç¤ºäº†æ‚¨åœ¨å››å¤§é¢å‘çš„å¹³è¡¡ç‹€æ…‹</div>
        <div class="chart-box-pdf"><canvas id="pdfRadarChart"></canvas></div>
        <div style="text-align:center; margin-top:80px; color:#555; font-size:14px; border: 2px solid #eee; padding: 20px; border-radius: 10px; line-height: 1.8;">
            <p><strong>æœ¬å ±å‘Šç”±ã€Œå…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç³»çµ±ã€ç”Ÿæˆ</strong></p>
            <p>æ•¸æ“šåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è¦åŠƒå»ºè­°é ç´„ CFP é¡§å• <strong>æ—é¦¬ä¸</strong> é€²è¡Œæ·±åº¦è§£è®€ã€‚</p>
        </div>
        <div class="page-footer">- ç¬¬ 3 é  / å…± 3 é  -</div>
    </div>
</div>

<script>
    const questions = {
        finance: { label: "è²¡å‹™åŸºç«™", items: ["è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ (0åˆ†<30% | 5åˆ†>100%)", "ç·Šæ€¥é å‚™é‡‘å……è¶³åº¦ (0åˆ†<3å€‹æœˆ | 5åˆ†>6å€‹æœˆ)", "é†«ç™‚é˜²ç¦¦ä¿‚æ•¸ (0åˆ† ä¸è¶³ | 5åˆ† å……è¶³)", "è² å‚µæ­¸é›¶è¨ˆç•« (0åˆ† ç„¡è¨ˆåŠƒ | 5åˆ† ç„¡è² å‚µ)", "è³‡ç”¢é…ç½®å¤šå…ƒæ€§ (0åˆ† å–®ä¸€ | 5åˆ† å¤šå…ƒ)"] },
        health: { label: "èº«å¿ƒçºŒèˆª", items: ["èº«é«”è³ªé‡æŒ‡æ•¸ (BMI) (0åˆ† ç•°å¸¸ | 5åˆ† æ¨™æº–)", "è‚Œè‚‰é‡èˆ‡è¡Œå‹•åŠ› (0åˆ† è¡°é€€ | 5åˆ† è‰¯å¥½)", "è¦å¾‹é‹å‹•ç¿’æ…£ (0åˆ† ä¸é‹å‹• | 5åˆ† æ¯é€±å¤šæ–¼ä¸‰æ¬¡))", "ç¡çœ å“è³ª (0åˆ† å°æ–¼äº”å°æ™‚ | 5åˆ† å¤šæ–¼ä¸ƒå°æ™‚)", "å®¶æ—ç—…å²è¿½è¹¤ (0åˆ† ç„¡é«”æª¢ç¿’æ…£ | 5åˆ† æ¯å¹´å®šæœŸæª¢æŸ¥)"] },
        social: { label: "ç¤¾äº¤æ¼«éŠ", items: ["éè·å ´æœ‹å‹æ•¸é‡ (0åˆ† å°‘æ–¼ä¸‰äºº | 5åˆ† å¤šæ–¼åäºº)", "è·¨ä»£é€£çµé »ç‡ (0åˆ† ç„¡ | 5åˆ† é »ç¹)", "ç¤¾ç¾¤åƒèˆ‡åº¦ (0åˆ† å­¤ç«‹ | 5åˆ† ç©æ¥µæŠ•å…¥)", "è¦ªå¯†é—œä¿‚å¸³æˆ¶ (0åˆ† ç–é  | 5åˆ† ç·Šå¯†æ”¯æŒ)", "ç·Šæ€¥æ•‘æ´ç¶² (0åˆ† ç„¡å»ºç«‹ | 5åˆ† éš¨æ™‚å¯æ±‚åŠ©)"] },
        purpose: { label: "ç¬¬äºŒäººç”Ÿ", items: ["èº«ä»½èªåŒåˆ‡æ› (0åˆ† ç„¡æ³• | 5åˆ† é †åˆ©è½‰æ›)", "æ™‚é–“çµæ§‹åŒ–èƒ½åŠ› (0åˆ† æ··äº‚ | 5åˆ† äº•ç„¶æœ‰åº)", "å¿ƒæµé«”é©—é »ç‡ (0åˆ† ç„¡ | 5åˆ† ç¶“å¸¸ç™¼ç”Ÿ)", "å­¸ç¿’æ–°æŠ€èƒ½æ„é¡˜ (0åˆ† ç„¡æ„é¡˜ | 5åˆ† æŒçºŒå­¸ç¿’)", "åœ“å¤¢åŸ·è¡ŒåŠ› (0åˆ† æ‹–å»¶ | 5åˆ† ç©æ¥µè¡Œå‹•)"] }
    };

    let webChart = null, pdfChart = null;

    function init() {
        const container = document.getElementById('quizContainer');
        for (let key in questions) {
            let section = document.createElement('div');
            section.className = 'quadrant-box';
            section.innerHTML = `<div class="quadrant-title">${questions[key].label}</div>`;
            questions[key].items.forEach(item => {
                section.innerHTML += `
                    <div class="question-row">
                        <span style="flex:1; line-height:1.4;">${item}</span>
                        <div class="input-wrapper">
                            <input type="range" min="0" max="5" value="0" data-cat="${key}" oninput="this.nextElementSibling.innerText = this.value">
                            <span style="font-weight:bold; margin-left:10px; width:20px; text-align:center;">0</span>
                        </div>
                    </div>`;
            });
            container.appendChild(section);
        }
        document.getElementById('pdfDate').innerText = new Date().toLocaleDateString();
    }

    function getAdvice(score, type) {
        let level = score >= 20 ? 'high' : (score >= 11 ? 'mid' : 'low');
        const logic = {
            finance: { low: "ç”Ÿå­˜ç„¦æ…®æœŸï¼šè¢«å‹•æ”¶å…¥åš´é‡ä¸è¶³ã€‚å»ºè­°å„ªå…ˆåŸ·è¡Œå‚µå‹™é›ªçƒæ³•ï¼Œä¸¦å¼·åˆ¶å­˜æ»¿3å€‹æœˆç·Šæ€¥é å‚™é‡‘ã€‚", mid: "è³‡ç”¢ç´¯ç©æœŸï¼šè³‡ç”¢æŠ—é€šè†¨åŠ›è„†å¼±ã€‚å»ºè­°å°‡è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ç›®æ¨™è¨­ç‚º70%ï¼Œä¸¦è£œè¶³é†«ç™‚ç¼ºå£ã€‚", high: "è²¡å¯Œå‚³æ‰¿æœŸï¼šè²¡å‹™è‡ªç”±ã€‚å»ºè­°è«®è©¢ä¿¡è¨—æ¶æ§‹æˆ–ç¨…å‹™è¦åŠƒï¼Œç¢ºä¿è³‡ç”¢èƒ½ä¾æ‚¨çš„æ„é¡˜å‚³æ‰¿ã€‚" },
            health: { low: "å¥åº·å´©å£æœŸï¼šé€€ä¼‘æœ€å¤§éš±æ†‚ã€‚è«‹ç«‹å³é ç´„å¥æª¢ï¼Œä¸¦å¾ã€Œæ¯å¤©æ­¥è¡Œ15åˆ†é˜ã€èˆ‡æ¸›ç³–é£²é£Ÿé–‹å§‹ã€‚", mid: "äºå¥åº·èª¿æ•´æœŸï¼šè‚ŒåŠ›æœ‰æµå¤±é¢¨éšªã€‚å»ºè­°æ¯é€±è‡³å°‘2æ¬¡é˜»åŠ›è¨“ç·´ï¼Œä¸¦é…æˆ´è£ç½®ç›£æ§ç¡çœ ã€‚", high: "æ¨‚æ´»é•·å£½æœŸï¼šé«”æ³æ¥µä½³ã€‚å»ºè­°æŒçºŒæŒ‘æˆ°éœ€ã€Œè…¦é«”å”èª¿ã€çš„æ–°é‹å‹•ï¼ˆå¦‚ç¶²çƒã€èˆè¹ˆï¼‰ã€‚" },
            social: { low: "å­¤å³¶æ•ˆæ‡‰æœŸï¼šç”Ÿæ´»åœˆå°é–‰ã€‚å»ºè­°æ¯æœˆä¸»å‹•è¯ç¹«ä¸€ä½è€å‹ï¼Œä¸¦å¼·åˆ¶è‡ªå·±åƒåŠ ä¸€å€‹å¯¦é«”èˆˆè¶£ç¤¾åœ˜ã€‚", mid: "ç¤¾äº¤é‡çµ„æœŸï¼šé€£çµæ·±åº¦ä¸è¶³ã€‚å»ºè­°æŒ‘é¸3ä½æœ‹å‹å»ºç«‹æ·±åº¦èšæœƒï¼Œä¸¦å»ºç«‹ç·Šæ€¥äº’åŠ©è¯çµ¡ç¶²ã€‚", high: "ç¤¾ç¾¤æ¨ç´æœŸï¼šäººè„ˆå»£é—Šã€‚å»ºè­°é€²è¡Œç¤¾äº¤æ–·æ¨é›¢ï¼Œå°‡æ™‚é–“ç•™çµ¦çœŸæ­£æ»‹é¤Šå¿ƒéˆçš„æ·±åº¦é—œä¿‚ã€‚" },
            purpose: { low: "å¤±å»é‡åŠ›æœŸï¼šè‡ªæˆ‘åƒ¹å€¼è¿·æƒ˜ã€‚è«‹ç·´ç¿’ã€Œä¸æè·ç¨±ã€ä»‹ç´¹è‡ªå·±ï¼Œåˆ—å‡º10å€‹èˆˆè¶£é€²è¡Œä½æˆæœ¬è©¦éŒ¯ã€‚", mid: "æ¢ç´¢å®šéŒ¨æœŸï¼šç¼ºä¹åŸ·è¡ŒåŠ›ã€‚è«‹è¨­å®šå…·é«”çš„å­¸ç¿’ç›®æ¨™ï¼ˆå¦‚è€ƒè­‰ç…§ï¼‰ï¼Œå°‡èˆˆè¶£è½‰åŒ–ç‚ºç”¢å‡ºã€‚", high: "è‡ªæˆ‘å¯¦ç¾æœŸï¼šç›®æ¨™æ¸…æ™°ã€‚è«‹å³åˆ»å•Ÿå‹•åœ“å¤¢å¤§è¨ˆç•«ï¼Œæˆ–é€éå¯«ä½œã€æ¼”è¬›åˆ†äº«äººç”Ÿæ™ºæ…§ã€‚" }
        };
        return logic[type][level];
    }

    function drawChart(id, data, isPdf) {
        const ctx = document.getElementById(id).getContext('2d');
        return new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ['è²¡å‹™', 'å¥åº·', 'ç¤¾äº¤', 'äººç”Ÿ'],
                datasets: [{
                    label: 'å¾—åˆ†', data: data,
                    backgroundColor: 'rgba(0, 86, 179, 0.2)',
                    borderColor: '#0056b3', borderWidth: 2,
                    pointBackgroundColor: '#0056b3', pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: isPdf ? false : { duration: 1000 },
                scales: {
                    r: { suggestedMin: 0, suggestedMax: 25, angleLines: { display: true }, ticks: { stepSize: 5, display: !isPdf, backdropColor: 'transparent' } }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function showWebResults() {
        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => {
            scores[input.dataset.cat] += parseInt(input.value);
        });
        const total = Object.values(scores).reduce((a,b)=>a+b, 0);
        const data = [scores.finance, scores.health, scores.social, scores.purpose];

        document.getElementById('webTotal').innerText = total;
        document.getElementById('pdfTotal').innerText = total;

        let adviceHtml = '', pdfTable = '', pdfAdvice = '';
        for(let key in questions) {
            let s = scores[key];
            let status = s>=20?"å„ªè‰¯":(s>=11?"å°šå¯":"åŠ æ²¹");
            let color = s>=20?"green":(s>=11?"#d39e00":"#d9534f");
            
            adviceHtml += `<div class="web-advice-item"><b>${questions[key].label}</b>: ${getAdvice(s, key)}</div>`;
            pdfTable += `<tr><td>${questions[key].label}</td><td style="font-weight:bold; font-size:1.1em;">${s}</td><td style="color:${color};font-weight:bold">${status}</td></tr>`;
            pdfAdvice += `<div style="margin-bottom:12px; padding:10px; background:#f9f9f9; border-left:4px solid ${color}; font-size:16px; text-align:justify; line-height:1.5;"><b>${questions[key].label}:</b> ${getAdvice(s, key)}</div>`;
        }

        document.getElementById('webAdviceList').innerHTML = adviceHtml;
        document.getElementById('pdfTableBody').innerHTML = pdfTable;
        document.getElementById('pdfAdviceList').innerHTML = pdfAdvice;

        document.getElementById('inputSection').style.display = 'none';
        document.getElementById('resultSection').style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });

        if(webChart) webChart.destroy();
        webChart = drawChart('webRadarChart', data, false);
    }

    // === V34 æ ¸å¿ƒï¼šé›™è»Œç­–ç•¥ (é›»è…¦ç›´æ¥å­˜ / æ‰‹æ©Ÿé–‹è¦–çª—) ===
    async function startPdfProcess() {
        document.getElementById('loadingOverlay').style.display = 'block';
        
        // 1. æš«å­˜ Body æ¨£å¼ (ç¢ºä¿é‚„åŸ)
        const originalPadding = document.body.style.padding;
        document.body.style.padding = '0';
        window.scrollTo(0, 0);

        // 2. åˆ‡æ› DOMï¼šéš±è—æ‰‹æ©Ÿå±¤ï¼Œé¡¯ç¤º PDF å±¤
        // è®“ä½¿ç”¨è€…çœ‹å¾—åˆ°è¦å°çš„æ±è¥¿ (WYSIWYG)
        document.getElementById('mobileAppLayer').style.display = 'none';
        document.getElementById('pdfPrintLayer').style.display = 'block';

        // 3. ç¹ªè£½ PDF åœ–è¡¨
        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => {
            scores[input.dataset.cat] += parseInt(input.value);
        });
        const data = [scores.finance, scores.health, scores.social, scores.purpose];
        
        if(pdfChart) pdfChart.destroy();
        // å»¶é²ç¢ºä¿ DOM æ¸²æŸ“
        await new Promise(r => setTimeout(r, 100));
        pdfChart = drawChart('pdfRadarChart', data, true);

        // 4. ç­‰å¾…åœ–è¡¨å®Œå…¨ç•«å¥½ (å®‰å…¨ç­‰å¾… 1 ç§’)
        await new Promise(r => setTimeout(r, 1000));

        // 5. æª¢æ¸¬æ‰‹æ©Ÿ
        const isMobile = window.innerWidth < 800;
        const timeStr = new Date().getHours() + "" + new Date().getMinutes();
        const fileName = `é€€ä¼‘æª¢æ¸¬_${timeStr}.pdf`;

        const element = document.getElementById('pdfPrintLayer');
        const opt = {
            margin: 0,
            filename: fileName,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { 
                scale: isMobile ? 1 : 2, // æ‰‹æ©Ÿé™è¦ä¿å¹³å®‰
                useCORS: true, 
                scrollY: 0,
                windowWidth: 794,
                x: 0, y: 0
            },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
            enableLinks: false
        };

        try {
            if (isMobile) {
                // === æ‰‹æ©Ÿç‰ˆç­–ç•¥ï¼šè½‰ Blob ä¸¦é–‹æ–°è¦–çª— ===
                // é€™æ˜¯æœ€ç©©å®šçš„ï¼Œå› ç‚ºç”¨æˆ¶èƒ½ç›´æ¥çœ‹åˆ° PDFï¼Œç„¶å¾Œæ‰‹å‹•æŒ‰åˆ†äº«/å„²å­˜
                const worker = html2pdf().set(opt).from(element);
                const pdfBlob = await worker.output('blob');
                const blobUrl = URL.createObjectURL(pdfBlob);
                
                // å˜—è©¦é–‹æ–°åˆ†é 
                const newWin = window.open(blobUrl, '_blank');
                
                if (newWin) {
                    // æˆåŠŸé–‹å•Ÿï¼Œæç¤ºç”¨æˆ¶
                    setTimeout(() => alert('âœ… å ±å‘Šå·²ç”Ÿæˆï¼\n\nè«‹åœ¨è·³å‡ºçš„è¦–çª—ä¸­é»é¸ã€Œåˆ†äº«ã€åœ–ç¤ºï¼Œç„¶å¾Œé¸æ“‡ã€Œå„²å­˜åˆ°æª”æ¡ˆã€ã€‚'), 500);
                } else {
                    // è¢«ç€è¦½å™¨æ“‹ä½å½ˆçª—ï¼Œæ”¹ç”¨ç•¶å‰é é¢è·³è½‰
                    alert('âœ… å ±å‘Šå·²ç”Ÿæˆï¼\n\nå³å°‡è·³è½‰è‡³ PDF é è¦½é é¢ï¼Œè«‹ä½¿ç”¨ç€è¦½å™¨é¸å–®é€²è¡Œä¸‹è¼‰ã€‚');
                    window.location.href = blobUrl;
                }
            } else {
                // === é›»è…¦ç‰ˆç­–ç•¥ï¼šç›´æ¥ä¸‹è¼‰ ===
                await html2pdf().set(opt).from(element).save();
                alert(`âœ… ä¸‹è¼‰æˆåŠŸï¼\næª”åï¼š${fileName}`);
            }
        } catch (err) {
            alert('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š' + err.message);
        } finally {
            // 6. é‚„åŸä»‹é¢
            document.body.style.padding = originalPadding;
            document.getElementById('pdfPrintLayer').style.display = 'none';
            document.getElementById('mobileAppLayer').style.display = 'block';
            document.getElementById('loadingOverlay').style.display = 'none';
            window.scrollTo(0, 0);
        }
    }

    init();
</script>

</body>
</html>
