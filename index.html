<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ | æ‚¨çš„å°ˆå±¬CFPé¡§å•</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #0056b3;
            --accent-color: #f8f9fa;
            --bg-color: #f4f7f6;
        }
        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        /* === äº’å‹•ä»‹é¢æ¨£å¼ === */
        h1 { color: var(--primary-color); text-align: center; }
        .quadrant-box {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        .quadrant-title {
            font-weight: bold;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        .question-row { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
        input[type="range"] { flex: 1; margin: 0 10px; cursor: pointer; }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn:hover { background-color: #004494; }

        /* === PDF å ±å‘Šæ¨£å¼ (é—œéµä¿®æ­£å€) === */
        #reportCard {
            display: none; /* åˆå§‹éš±è— */
            background: white;
            width: 100%;
            /* ä¿®æ­£ï¼šç§»é™¤å¤šé¤˜é‚Šè·ï¼Œé¿å…æº¢å‡º */
            margin: 0; 
            padding: 0;
        }

        /* ç¬¬ä¸€é ï¼šç¸½çµå€ */
        .page-one {
            padding: 30px 40px;
            background: #fff;
            /* ä¿®æ­£ï¼šç§»é™¤ page-break-afterï¼Œé¿å…èˆ‡ä¸‹ä¸€é çš„ before è¡çª */
            margin-bottom: 0;
        }

        /* æ¨™é¡Œå¼·åˆ¶æ­¸é›¶ï¼Œé¿å…é ‚éƒ¨ç•™ç™½ */
        .page-one h2 { margin-top: 0; padding-top: 0; color: var(--primary-color); text-align: center; }

        /* ç¬¬äºŒé ï¼šè©³æƒ…å€ */
        .page-two {
            padding: 30px 40px;
            background: #fff;
            /* é—œéµä¿®æ­£ï¼šåªåœ¨é€™è£¡è¨­å®šå¼·åˆ¶æ›é ï¼Œç¢ºä¿å¾æ–°é é¢é–‹å§‹ */
            page-break-before: always; 
        }

        /* è¡¨æ ¼æ¨£å¼ */
        .score-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .score-table th, .score-table td {
            border: 1px solid #333;
            padding: 10px;
            text-align: center;
        }
        .score-table th { background-color: var(--primary-color); color: white; }

        /* è¡Œå‹•å»ºè­°å¡ */
        .action-item {
            margin-bottom: 12px;
            padding: 12px;
            background: var(--accent-color);
            border-left: 6px solid var(--primary-color);
            border-radius: 4px;
        }
        .action-title { font-weight: bold; color: #333; margin-bottom: 4px; }
        .action-text { font-size: 0.95em; color: #555; text-align: justify; line-height: 1.5; }

        .footer-note {
            text-align: center;
            font-size: 0.8em;
            color: #888;
            margin-top: 30px;
        }
    </style>
</head>
<body>

<div class="container" id="mainWrapper">
    
    <div id="inputForm">
        <h1>é€€ä¼‘æº–å‚™åº¦æª¢æ¸¬ç«™</h1>
        <p style="text-align: center; color: #666;">è«‹æ»‘å‹•è©•åˆ† (0åˆ†:ä¸è¶³ ~ 5åˆ†:å……è¶³)</p>
        <div id="quizContainer"></div>
        <button type="button" class="btn" onclick="generateReport()">æŸ¥çœ‹è¨ºæ–·çµæœ</button>
    </div>

    <div id="reportCard">
        
        <div class="page-one">
            <h2>å…¨æ–¹ä½é€€ä¼‘æº–å‚™åº¦è¨ºæ–·æ›¸</h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px;">è¨ºæ–·æ—¥æœŸï¼š<span id="reportDate"></span></p>

            <div style="text-align: center; background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <div style="font-size: 1.1em; color: #555;">æ‚¨çš„ç¶œåˆè©•ä¼°å¾—åˆ†</div>
                <div style="font-size: 3em; font-weight: bold; color: #d9534f; line-height: 1.2;">
                    <span id="finalTotal">0</span> <span style="font-size: 0.4em; color:#888;">/ 100</span>
                </div>
            </div>

            <table class="score-table">
                <thead>
                    <tr>
                        <th width="35%">æª¢æ¸¬é¢å‘</th>
                        <th width="25%">å¾—åˆ†</th>
                        <th width="40%">ç‹€æ…‹è©•ä¼°</th>
                    </tr>
                </thead>
                <tbody id="scoreTableBody"></tbody>
            </table>
            
            <div class="footer-note" style="border:none; margin-top: 40px;">
                ( ä¸‹ä¸€é ï¼šæ‚¨çš„å°ˆå±¬è¡Œå‹•æ–¹é‡ )
            </div>
        </div>

        <div class="page-two">
            <h3 style="color: var(--primary-color); border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-top: 0;">ã€å°ˆå±¬è¡Œå‹•æ–¹é‡ã€‘</h3>
            
            <div id="actionPlanList"></div>

            <div class="footer-note">
                æœ¬å ±å‘Šç”± AI è¼”åŠ©ç³»çµ±ç”Ÿæˆ<br>å»ºè­°é ç´„æ‚¨çš„ CFP é¡§å•é€²è¡Œæ·±å…¥è§£è®€
            </div>
        </div>
        
        <div style="padding: 20px 40px; text-align: center;">
            <button class="btn" style="background-color: #28a745;" onclick="downloadPDF()">ğŸ“¥ ä¸‹è¼‰å®Œæ•´ PDF å ±å‘Š</button>
            <button class="btn" style="background-color: #6c757d; margin-top: 10px;" onclick="location.reload()">ğŸ”„ é‡æ–°æ¸¬é©—</button>
        </div>

    </div>
</div>

<script>
    const questions = {
        finance: { label: "è²¡å‹™åŸºç«™", items: ["è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ (0åˆ†<30% | 5åˆ†>100%)", "ç·Šæ€¥é å‚™é‡‘å……è¶³åº¦ (0åˆ†<3å€‹æœˆ | 5åˆ†>6å€‹æœˆ)", "é†«ç™‚é˜²ç¦¦ä¿‚æ•¸ (0åˆ† ä¸è¶³ | 5åˆ† å……è¶³)", "è² å‚µæ­¸é›¶è¨ˆç•« (0åˆ† ç„¡è¨ˆåŠƒ | 5åˆ† ç„¡è² å‚µ)", "è³‡ç”¢é…ç½®å¤šå…ƒæ€§ (0åˆ† å–®ä¸€ | 5åˆ† å¤šå…ƒ)"] },
        health: { label: "èº«å¿ƒçºŒèˆª", items: ["èº«é«”è³ªé‡æŒ‡æ•¸ (BMI) (0åˆ† ç•°å¸¸ | 5åˆ† æ¨™æº–)", "è‚Œè‚‰é‡èˆ‡è¡Œå‹•åŠ› (0åˆ† è¡°é€€ | 5åˆ† è‰¯å¥½)", "è¦å¾‹é‹å‹•ç¿’æ…£ (0åˆ† ä¸é‹å‹• | 5åˆ† æ¯é€±å¤šæ–¼ä¸‰æ¬¡))", "ç¡çœ å“è³ª (0åˆ† å°æ–¼äº”å°æ™‚ | 5åˆ† å¤šæ–¼ä¸ƒå°æ™‚)", "å®¶æ—ç—…å²è¿½è¹¤ (0åˆ† ç„¡é«”æª¢ç¿’æ…£ | 5åˆ† æ¯å¹´å®šæœŸæª¢æŸ¥)"] },
        social: { label: "ç¤¾äº¤æ¼«éŠ", items: ["éè·å ´æœ‹å‹æ•¸é‡ (0åˆ† å°‘æ–¼ä¸‰äºº | 5åˆ† å¤šæ–¼åäºº)", "è·¨ä»£é€£çµé »ç‡ (0åˆ† ç„¡ | 5åˆ† é »ç¹)", "ç¤¾ç¾¤åƒèˆ‡åº¦ (0åˆ† å­¤ç«‹ | 5åˆ† ç©æ¥µæŠ•å…¥)", "è¦ªå¯†é—œä¿‚å¸³æˆ¶ (0åˆ† ç–é  | 5åˆ† ç·Šå¯†æ”¯æŒ)", "ç·Šæ€¥æ•‘æ´ç¶² (0åˆ† ç„¡å»ºç«‹ | 5åˆ† éš¨æ™‚å¯æ±‚åŠ©)"] },
        purpose: { label: "ç¬¬äºŒäººç”Ÿ", items: ["èº«ä»½èªåŒåˆ‡æ› (0åˆ† ç„¡æ³• | 5åˆ† é †åˆ©è½‰æ›)", "æ™‚é–“çµæ§‹åŒ–èƒ½åŠ› (0åˆ† æ··äº‚ | 5åˆ† äº•ç„¶æœ‰åº)", "å¿ƒæµé«”é©—é »ç‡ (0åˆ† ç„¡ | 5åˆ† ç¶“å¸¸ç™¼ç”Ÿ)", "å­¸ç¿’æ–°æŠ€èƒ½æ„é¡˜ (0åˆ† ç„¡æ„é¡˜ | 5åˆ† æŒçºŒå­¸ç¿’)", "åœ“å¤¢åŸ·è¡ŒåŠ› (0åˆ† æ‹–å»¶ | 5åˆ† ç©æ¥µè¡Œå‹•)"] }
    };

    function init() {
        const container = document.getElementById('quizContainer');
        for (let key in questions) {
            let section = document.createElement('div');
            section.className = 'quadrant-box';
            let html = `<div class="quadrant-title">${questions[key].label}</div>`;
            questions[key].items.forEach(item => {
                html += `
                    <div class="question-row">
                        <span style="flex:1">${item}</span>
                        <input type="range" min="0" max="5" value="0" data-cat="${key}" oninput="this.nextElementSibling.innerText = this.value">
                        <span style="width:20px; text-align:center; font-weight:bold;">0</span>
                    </div>`;
            });
            section.innerHTML = html;
            container.appendChild(section);
        }
        document.getElementById('reportDate').innerText = new Date().toLocaleDateString();
    }

    function getAdvice(score, type) {
        let level = score >= 20 ? 'high' : (score >= 11 ? 'mid' : 'low');
        const logic = {
            finance: {
                low: "ç”Ÿå­˜ç„¦æ…®æœŸï¼šè¢«å‹•æ”¶å…¥åš´é‡ä¸è¶³ã€‚å»ºè­°å„ªå…ˆåŸ·è¡Œå‚µå‹™é›ªçƒæ³•ï¼Œä¸¦å¼·åˆ¶å­˜æ»¿3å€‹æœˆç·Šæ€¥é å‚™é‡‘ã€‚",
                mid: "è³‡ç”¢ç´¯ç©æœŸï¼šè³‡ç”¢æŠ—é€šè†¨åŠ›è„†å¼±ã€‚å»ºè­°å°‡è¢«å‹•æ”¶å…¥è¦†è“‹ç‡ç›®æ¨™è¨­ç‚º70%ï¼Œä¸¦è£œè¶³é†«ç™‚ç¼ºå£ã€‚",
                high: "è²¡å¯Œå‚³æ‰¿æœŸï¼šè²¡å‹™è‡ªç”±ã€‚å»ºè­°è«®è©¢ä¿¡è¨—æ¶æ§‹æˆ–ç¨…å‹™è¦åŠƒï¼Œç¢ºä¿è³‡ç”¢èƒ½ä¾æ‚¨çš„æ„é¡˜å‚³æ‰¿ã€‚"
            },
            health: {
                low: "å¥åº·å´©å£æœŸï¼šé€€ä¼‘æœ€å¤§éš±æ†‚ã€‚è«‹ç«‹å³é ç´„å¥æª¢ï¼Œä¸¦å¾ã€Œæ¯å¤©æ­¥è¡Œ15åˆ†é˜ã€èˆ‡æ¸›ç³–é£²é£Ÿé–‹å§‹ã€‚",
                mid: "äºå¥åº·èª¿æ•´æœŸï¼šè‚ŒåŠ›æœ‰æµå¤±é¢¨éšªã€‚å»ºè­°æ¯é€±è‡³å°‘2æ¬¡é˜»åŠ›è¨“ç·´ï¼Œä¸¦é…æˆ´è£ç½®ç›£æ§ç¡çœ ã€‚",
                high: "æ¨‚æ´»é•·å£½æœŸï¼šé«”æ³æ¥µä½³ã€‚å»ºè­°æŒçºŒæŒ‘æˆ°éœ€ã€Œè…¦é«”å”èª¿ã€çš„æ–°é‹å‹•ï¼ˆå¦‚ç¶²çƒã€èˆè¹ˆï¼‰ã€‚"
            },
            social: {
                low: "å­¤å³¶æ•ˆæ‡‰æœŸï¼šç”Ÿæ´»åœˆå°é–‰ã€‚å»ºè­°æ¯æœˆä¸»å‹•è¯ç¹«ä¸€ä½è€å‹ï¼Œä¸¦å¼·åˆ¶è‡ªå·±åƒåŠ ä¸€å€‹å¯¦é«”èˆˆè¶£ç¤¾åœ˜ã€‚",
                mid: "ç¤¾äº¤é‡çµ„æœŸï¼šé€£çµæ·±åº¦ä¸è¶³ã€‚å»ºè­°æŒ‘é¸3ä½æœ‹å‹å»ºç«‹æ·±åº¦èšæœƒï¼Œä¸¦å»ºç«‹ç·Šæ€¥äº’åŠ©è¯çµ¡ç¶²ã€‚",
                high: "ç¤¾ç¾¤æ¨ç´æœŸï¼šäººè„ˆå»£é—Šã€‚å»ºè­°é€²è¡Œç¤¾äº¤æ–·æ¨é›¢ï¼Œå°‡æ™‚é–“ç•™çµ¦çœŸæ­£æ»‹é¤Šå¿ƒéˆçš„æ·±åº¦é—œä¿‚ã€‚"
            },
            purpose: {
                low: "å¤±å»é‡åŠ›æœŸï¼šè‡ªæˆ‘åƒ¹å€¼è¿·æƒ˜ã€‚è«‹ç·´ç¿’ã€Œä¸æè·ç¨±ã€ä»‹ç´¹è‡ªå·±ï¼Œåˆ—å‡º10å€‹èˆˆè¶£é€²è¡Œä½æˆæœ¬è©¦éŒ¯ã€‚",
                mid: "æ¢ç´¢å®šéŒ¨æœŸï¼šç¼ºä¹åŸ·è¡ŒåŠ›ã€‚è«‹è¨­å®šå…·é«”çš„å­¸ç¿’ç›®æ¨™ï¼ˆå¦‚è€ƒè­‰ç…§ï¼‰ï¼Œå°‡èˆˆè¶£è½‰åŒ–ç‚ºç”¢å‡ºã€‚",
                high: "è‡ªæˆ‘å¯¦ç¾æœŸï¼šç›®æ¨™æ¸…æ™°ã€‚è«‹å³åˆ»å•Ÿå‹•åœ“å¤¢å¤§è¨ˆç•«ï¼Œæˆ–é€éå¯«ä½œã€æ¼”è¬›åˆ†äº«äººç”Ÿæ™ºæ…§ã€‚"
            }
        };
        return logic[type][level];
    }

    function generateReport() {
        let scores = { finance: 0, health: 0, social: 0, purpose: 0 };
        document.querySelectorAll('input[type="range"]').forEach(input => {
            scores[input.dataset.cat] += parseInt(input.value);
        });

        let total = Object.values(scores).reduce((a,b)=>a+b, 0);
        document.getElementById('finalTotal').innerText = total;

        let tableHtml = '';
        let actionHtml = '';
        
        for (let key in questions) {
            let s = scores[key];
            let status = s >= 20 ? "å„ªè‰¯" : (s >= 11 ? "å°šå¯" : "åŠ æ²¹");
            let color = s >= 20 ? "green" : (s >= 11 ? "#d39e00" : "#d9534f");
            
            tableHtml += `
                <tr>
                    <td>${questions[key].label}</td>
                    <td style="font-weight:bold; font-size:1.2em;">${s}</td>
                    <td style="color:${color}; font-weight:bold;">${status}</td>
                </tr>`;

            actionHtml += `
                <div class="action-item">
                    <div class="action-title">é‡å°ã€Œ${questions[key].label}ã€(${status}) çš„å»ºè­°ï¼š</div>
                    <div class="action-text">${getAdvice(s, key)}</div>
                </div>`;
        }

        document.getElementById('scoreTableBody').innerHTML = tableHtml;
        document.getElementById('actionPlanList').innerHTML = actionHtml;

        // ä¿®æ­£ï¼šéš±è—è¼¸å…¥å€ï¼Œç›´æ¥é¡¯ç¤ºå ±å‘Šå€ (åŒ…å«å…©é å…§å®¹èˆ‡ä¸‹è¼‰æŒ‰éˆ•)
        document.getElementById('inputForm').style.display = 'none';
        document.getElementById('reportCard').style.display = 'block';
        
        // æ»¾å‹•åˆ°é ‚éƒ¨ä»¥ä¾¿é–±è®€
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function downloadPDF() {
        // é€™è£¡æˆ‘å€‘é¸æ“‡åªæˆªå– "page-one" å’Œ "page-two" çš„çˆ¶å®¹å™¨ï¼Œä¸åŒ…å«ä¸‹è¼‰æŒ‰éˆ•
        // ç‚ºäº†åšåˆ°é€™é»ï¼Œæˆ‘å€‘å‹•æ…‹å‰µå»ºä¸€å€‹è‡¨æ™‚å®¹å™¨ï¼Œæˆ–è€…åˆ©ç”¨ html2pdf çš„é¸æ“‡å™¨
        // ç”±æ–¼ reportCard è£¡é¢ç¾åœ¨åŒ…å«äº†æŒ‰éˆ•ï¼Œæˆ‘å€‘éœ€è¦ç¨å¾®æŠ€å·§æ€§åœ°æ’é™¤æŒ‰éˆ•ï¼Œ
        // æœ€ç°¡å–®çš„æ–¹æ³•æ˜¯ï¼šä¸‹è¼‰æ™‚æš«æ™‚éš±è—æŒ‰éˆ•ï¼Œä¸‹è¼‰å®Œå†é¡¯ç¤ºã€‚
        
        const btns = document.querySelectorAll('#reportCard .btn');
        btns.forEach(b => b.style.display = 'none'); // æš«æ™‚éš±è—æŒ‰éˆ•

        const element = document.getElementById('reportCard');
        
        const opt = {
            margin:       0, // é‚Šè·æ­¸é›¶ï¼Œå®Œå…¨äº¤çµ¦ CSS æ§åˆ¶
            filename:     'é€€ä¼‘æº–å‚™åº¦è¨ºæ–·å ±å‘Š.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, useCORS: true, scrollY: 0 },
            jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        html2pdf().set(opt).from(element).save().then(() => {
            btns.forEach(b => b.style.display = 'block'); // æ¢å¾©æŒ‰éˆ•é¡¯ç¤º
        });
    }

    init();
</script>

</body>
</html>
